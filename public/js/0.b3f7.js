(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{4:function(e,t,n){"use strict";n.r(t);var C=n(0),r=n(1),a=n.n(r),w={isDev:!1,dpr:1,obj:{globalScale:.2,group_road_1:{path:"/3d/one/group_road_1/group_road_1",level:"one"},group_shop_1:{path:"/3d/one/group_shop_1/group_shop_1",level:"one"},group_parking_1:{path:"/3d/one/group_parking_1/group_parking_1",level:"one"},group_charging_pile_1:{path:"/3d/one/group_charging_pile_1/group_charging_pile_1",level:"one"},group_build_out_1:{path:"/3d/one/group_build_out_1/group_build_out_1",level:"one",childName:"building"},group_villa_1:{path:"/3d/one/group_villa_1/group_villa_1",level:"one"},group_camera_1:{path:"/3d/one/group_camera_1/group_camera_1",level:"one"},group_round_camera_1:{path:"/3d/one/group_round_camera_1/group_round_camera_1",level:"one"},group_barrier_gate_obj:{path:"/3d/one/group_barrier_gate_obj/barrier_gate_obj_1",level:"one"},group_barrier_gate_fbx:{path:"/3d/one/group_barrier_gate_fbx/barrier_gate_fbx_1.FBX",level:"one"},group_sign_1:{path:"/3d/one/group_sign_1/group_sign_1",level:"one"},RFID_1:{path:"/3d/one/RFID_1/RFID_1",level:"one"},water_obj:{path:"/3d/one/water_obj/water_obj",level:"one"},building:{path:"/3d/two/building_in/building_in",childName:"floor",level:"two",scale:.5},floor:{path:"/3d/three/floor/single_floor",level:"three",scale:2},stl2:{path:"/3d/main.STL"}},fog:{color:16777215,near:8e-4},camera:{fov:40,near:.1,far:1e3,aspect:1,posX:0,posY:100,posZ:500},controls:{autoRotate:!1,autoRotateSpeed:-.5,rotateSpeed:.5,zoomSpeed:.8,minDistance:10,maxDistance:600,minPolarAngle:Math.PI/5,maxPolarAngle:Math.PI/2,minAzimuthAngle:-1/0,maxAzimuthAngle:1/0,enableDamping:!0,dampingFactor:.5,enableZoom:!0,target:{x:0,y:0,z:0}},ambientLight:{enabled:!0,color:4271662},spotLight:{enabled:!0,helperEnabled:!1,color:16777215,indensity:2,position:{x:0,y:400,z:-400},angle:104.05,penumbra:.05,decay:2,distance:1e8}};function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var i=function(){function r(e,t){var n=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),this.scene=e,this.container=t,this.threeRenderer=new C.WebGLRenderer({antialias:!0}),this.threeRenderer.setClearColor(e.fog.color),this.threeRenderer.setPixelRatio(window.devicePixelRatio),t.appendChild(this.threeRenderer.domElement),this.threeRenderer.shadowMap.enabled=!0,this.threeRenderer.shadowMap.type=C.PCFSoftShadowMap,w.maxAnisotropy=this.threeRenderer.getMaxAnisotropy(),this.updateSize(),document.addEventListener("DOMContentLoaded",function(){return n.updateSize()},!1),window.addEventListener("resize",function(){return n.updateSize()},!1)}var e,t,n;return e=r,(t=[{key:"updateSize",value:function(){this.threeRenderer.setSize(this.container.offsetWidth,this.container.offsetHeight)}},{key:"render",value:function(e,t){this.threeRenderer.render(e,t)}}])&&o(e.prototype,t),n&&o(e,n),r}();function s(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var c=function(){function a(e){var t=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a);var n=e.domElement.width,r=e.domElement.height;this.threeCamera=new C.PerspectiveCamera(w.camera.fov,n/r,w.camera.near,w.camera.far),this.threeCamera.position.set(w.camera.posX,w.camera.posY,w.camera.posZ),this.updateSize(e),window.addEventListener("resize",function(){return t.updateSize(e)},!1)}var e,t,n;return e=a,(t=[{key:"updateSize",value:function(e){this.threeCamera.aspect=e.domElement.width/e.domElement.height,this.threeCamera.updateProjectionMatrix()}}])&&s(e.prototype,t),n&&s(e,n),a}();function l(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var u=function(){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.scene=e,this.init()}var e,n,r;return e=t,(n=[{key:"init",value:function(){this.ambientLight=new C.AmbientLight(w.ambientLight.color),this.ambientLight.visible=w.ambientLight.enabled;var e=w.spotLight,t=e.color,n=e.indensity,r=e.position,a=r.x,o=r.y,i=r.z,s=e.angle,c=e.distance,l=e.enabled,u=e.helperEnabled,h=e.penumbra;this.spotLight=new C.SpotLight(t,n),this.spotLight.position.set(a,o,i),this.spotLight.angle=s,this.spotLight.penumbra=h,this.spotLight.decay=2,this.spotLight.distance=c,this.spotLight.castShadow=l,this.spotLightHelper=new C.SpotLightHelper(this.spotLight),this.spotLightHelper.visible=u}},{key:"place",value:function(e){switch(e){case"ambient":this.scene.add(this.ambientLight);break;case"spot":this.scene.add(this.spotLight),this.scene.add(this.spotLightHelper)}}}])&&l(e.prototype,n),r&&l(e,r),t}(),h=function(I){var e=I.MOUSE;function S(e){this.object=e,this.target=new I.Vector3,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.25;var n,r,a,o,i,s,c,l,u,h=this,p=0,f=0,d=1,v=new I.Vector3,m=!1;this.getPolarAngle=function(){return r},this.getAzimuthalAngle=function(){return n},this.rotateLeft=function(e){f-=e},this.rotateUp=function(e){p-=e},this.panLeft=(a=new I.Vector3,function(e){var t=this.object.matrix.elements;a.set(t[0],t[1],t[2]),a.multiplyScalar(-e),v.add(a)}),this.panUp=(o=new I.Vector3,function(e){var t=this.object.matrix.elements;o.set(t[4],t[5],t[6]),o.multiplyScalar(e),v.add(o)}),this.pan=function(e,t,n,r){if(h.object instanceof I.PerspectiveCamera){var a=h.object.position.clone().sub(h.target).length();a*=Math.tan(h.object.fov/2*Math.PI/180),h.panLeft(2*e*a/r),h.panUp(2*t*a/r)}else h.object instanceof I.OrthographicCamera?(h.panLeft(e*(h.object.right-h.object.left)/n),h.panUp(t*(h.object.top-h.object.bottom)/r)):console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled.")},this.dollyIn=function(e){h.object instanceof I.PerspectiveCamera?d/=e:h.object instanceof I.OrthographicCamera?(h.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom*e)),h.object.updateProjectionMatrix(),m=!0):console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled.")},this.dollyOut=function(e){h.object instanceof I.PerspectiveCamera?d*=e:h.object instanceof I.OrthographicCamera?(h.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/e)),h.object.updateProjectionMatrix(),m=!0):console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled.")},this.update=(i=new I.Vector3,s=(new I.Quaternion).setFromUnitVectors(e.up,new I.Vector3(0,1,0)),c=s.clone().inverse(),l=new I.Vector3,u=new I.Quaternion,function(){var e=this.object.position;i.copy(e).sub(this.target),i.applyQuaternion(s),n=Math.atan2(i.x,i.z),r=Math.atan2(Math.sqrt(i.x*i.x+i.z*i.z),i.y),n+=f,r+=p,n=Math.max(this.minAzimuthAngle,Math.min(this.maxAzimuthAngle,n)),r=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,r)),r=Math.max(1e-6,Math.min(Math.PI-1e-6,r));var t=i.length()*d;return t=Math.max(this.minDistance,Math.min(this.maxDistance,t)),this.target.add(v),i.x=t*Math.sin(r)*Math.sin(n),i.y=t*Math.cos(r),i.z=t*Math.sin(r)*Math.cos(n),i.applyQuaternion(c),e.copy(this.target).add(i),this.object.lookAt(this.target),!0===this.enableDamping?(f*=1-this.dampingFactor,p*=1-this.dampingFactor):p=f=0,d=1,v.set(0,0,0),!(!(m||1e-6<l.distanceToSquared(this.object.position)||1e-6<8*(1-u.dot(this.object.quaternion)))||(l.copy(this.object.position),u.copy(this.object.quaternion),m=!1))})}function t(e,t){var o=new S(e);this.domElement=void 0!==t?t:document,Object.defineProperty(this,"constraint",{get:function(){return o}}),this.getPolarAngle=function(){return o.getPolarAngle()},this.getAzimuthalAngle=function(){return o.getAzimuthalAngle()},this.enabled=!0,this.center=this.target,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.enableKeys=!0,this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40},this.mouseButtons={ORBIT:I.MOUSE.LEFT,ZOOM:I.MOUSE.MIDDLE,PAN:I.MOUSE.RIGHT};var i=this,s=new I.Vector2,c=new I.Vector2,l=new I.Vector2,u=new I.Vector2,h=new I.Vector2,p=new I.Vector2,f=new I.Vector2,d=new I.Vector2,v=new I.Vector2,m={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_DOLLY:4,TOUCH_PAN:5},g=m.NONE;this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom;var n={type:"change"},a={type:"start"},r={type:"end"};function y(e,t){var n=i.domElement===document?i.domElement.body:i.domElement;o.pan(e,t,n.clientWidth,n.clientHeight)}function b(){return Math.pow(.95,i.zoomSpeed)}function w(e){if(!1!==i.enabled){if(e.preventDefault(),e.button===i.mouseButtons.ORBIT){if(!1===i.enableRotate)return;g=m.ROTATE,s.set(e.clientX,e.clientY)}else if(e.button===i.mouseButtons.ZOOM){if(!1===i.enableZoom)return;g=m.DOLLY,f.set(e.clientX,e.clientY)}else if(e.button===i.mouseButtons.PAN){if(!1===i.enablePan)return;g=m.PAN,u.set(e.clientX,e.clientY)}g!==m.NONE&&(document.addEventListener("mousemove",E,!1),document.addEventListener("mouseup",x,!1),i.dispatchEvent(a))}}function E(e){if(!1!==i.enabled){e.preventDefault();var t=i.domElement===document?i.domElement.body:i.domElement;if(g===m.ROTATE){if(!1===i.enableRotate)return;c.set(e.clientX,e.clientY),l.subVectors(c,s),o.rotateLeft(2*Math.PI*l.x/t.clientWidth*i.rotateSpeed),o.rotateUp(2*Math.PI*l.y/t.clientHeight*i.rotateSpeed),s.copy(c)}else if(g===m.DOLLY){if(!1===i.enableZoom)return;d.set(e.clientX,e.clientY),v.subVectors(d,f),0<v.y?o.dollyIn(b()):v.y<0&&o.dollyOut(b()),f.copy(d)}else if(g===m.PAN){if(!1===i.enablePan)return;h.set(e.clientX,e.clientY),p.subVectors(h,u),y(p.x,p.y),u.copy(h)}g!==m.NONE&&i.update()}}function x(){!1!==i.enabled&&(document.removeEventListener("mousemove",E,!1),document.removeEventListener("mouseup",x,!1),i.dispatchEvent(r),g=m.NONE)}function A(e){if(!1!==i.enabled&&!1!==i.enableZoom&&g===m.NONE){e.preventDefault(),e.stopPropagation();var t=0;void 0!==e.wheelDelta?t=e.wheelDelta:void 0!==e.detail&&(t=-e.detail),0<t?o.dollyOut(b()):t<0&&o.dollyIn(b()),i.update(),i.dispatchEvent(a),i.dispatchEvent(r)}}function T(e){if(!1!==i.enabled&&!1!==i.enableKeys&&!1!==i.enablePan)switch(e.keyCode){case i.keys.UP:y(0,i.keyPanSpeed),i.update();break;case i.keys.BOTTOM:y(0,-i.keyPanSpeed),i.update();break;case i.keys.LEFT:y(i.keyPanSpeed,0),i.update();break;case i.keys.RIGHT:y(-i.keyPanSpeed,0),i.update()}}function L(e){if(!1!==i.enabled){switch(e.touches.length){case 1:if(!1===i.enableRotate)return;g=m.TOUCH_ROTATE,s.set(e.touches[0].pageX,e.touches[0].pageY);break;case 2:if(!1===i.enableZoom)return;g=m.TOUCH_DOLLY;var t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY,r=Math.sqrt(t*t+n*n);f.set(0,r);break;case 3:if(!1===i.enablePan)return;g=m.TOUCH_PAN,u.set(e.touches[0].pageX,e.touches[0].pageY);break;default:g=m.NONE}g!==m.NONE&&i.dispatchEvent(a)}}function P(e){if(!1!==i.enabled){e.preventDefault(),e.stopPropagation();var t=i.domElement===document?i.domElement.body:i.domElement;switch(e.touches.length){case 1:if(!1===i.enableRotate)return;if(g!==m.TOUCH_ROTATE)return;c.set(e.touches[0].pageX,e.touches[0].pageY),l.subVectors(c,s),o.rotateLeft(2*Math.PI*l.x/t.clientWidth*i.rotateSpeed),o.rotateUp(2*Math.PI*l.y/t.clientHeight*i.rotateSpeed),s.copy(c),i.update();break;case 2:if(!1===i.enableZoom)return;if(g!==m.TOUCH_DOLLY)return;var n=e.touches[0].pageX-e.touches[1].pageX,r=e.touches[0].pageY-e.touches[1].pageY,a=Math.sqrt(n*n+r*r);d.set(0,a),v.subVectors(d,f),0<v.y?o.dollyOut(b()):v.y<0&&o.dollyIn(b()),f.copy(d),i.update();break;case 3:if(!1===i.enablePan)return;if(g!==m.TOUCH_PAN)return;h.set(e.touches[0].pageX,e.touches[0].pageY),p.subVectors(h,u),y(p.x,p.y),u.copy(h),i.update();break;default:g=m.NONE}}}function _(){!1!==i.enabled&&(i.dispatchEvent(r),g=m.NONE)}function C(e){e.preventDefault()}this.update=function(){this.autoRotate&&g===m.NONE&&o.rotateLeft(2*Math.PI/60/60*i.autoRotateSpeed),!0===o.update()&&this.dispatchEvent(n)},this.reset=function(){g=m.NONE,this.target.copy(this.target0),this.object.position.copy(this.position0),this.object.zoom=this.zoom0,this.object.updateProjectionMatrix(),this.dispatchEvent(n),this.update()},this.dispose=function(){this.domElement.removeEventListener("contextmenu",C,!1),this.domElement.removeEventListener("mousedown",w,!1),this.domElement.removeEventListener("mousewheel",A,!1),this.domElement.removeEventListener("MozMousePixelScroll",A,!1),this.domElement.removeEventListener("touchstart",L,!1),this.domElement.removeEventListener("touchend",_,!1),this.domElement.removeEventListener("touchmove",P,!1),document.removeEventListener("mousemove",E,!1),document.removeEventListener("mouseup",x,!1),window.removeEventListener("keydown",T,!1)},this.domElement.addEventListener("contextmenu",C,!1),this.domElement.addEventListener("mousedown",w,!1),this.domElement.addEventListener("mousewheel",A,!1),this.domElement.addEventListener("MozMousePixelScroll",A,!1),this.domElement.addEventListener("touchstart",L,!1),this.domElement.addEventListener("touchend",_,!1),this.domElement.addEventListener("touchmove",P,!1),window.addEventListener("keydown",T,!1),this.update()}return e||(e={LEFT:0,MIDDLE:1,RIGHT:2}),(t.prototype=Object.create(I.EventDispatcher.prototype)).constructor=t,Object.defineProperties(t.prototype,{object:{get:function(){return this.constraint.object}},target:{get:function(){return this.constraint.target},set:function(e){console.warn("THREE.OrbitControls: target is now immutable. Use target.set() instead."),this.constraint.target.copy(e)}},minDistance:{get:function(){return this.constraint.minDistance},set:function(e){this.constraint.minDistance=e}},maxDistance:{get:function(){return this.constraint.maxDistance},set:function(e){this.constraint.maxDistance=e}},minZoom:{get:function(){return this.constraint.minZoom},set:function(e){this.constraint.minZoom=e}},maxZoom:{get:function(){return this.constraint.maxZoom},set:function(e){this.constraint.maxZoom=e}},minPolarAngle:{get:function(){return this.constraint.minPolarAngle},set:function(e){this.constraint.minPolarAngle=e}},maxPolarAngle:{get:function(){return this.constraint.maxPolarAngle},set:function(e){this.constraint.maxPolarAngle=e}},minAzimuthAngle:{get:function(){return this.constraint.minAzimuthAngle},set:function(e){this.constraint.minAzimuthAngle=e}},maxAzimuthAngle:{get:function(){return this.constraint.maxAzimuthAngle},set:function(e){this.constraint.maxAzimuthAngle=e}},enableDamping:{get:function(){return this.constraint.enableDamping},set:function(e){this.constraint.enableDamping=e}},dampingFactor:{get:function(){return this.constraint.dampingFactor},set:function(e){this.constraint.dampingFactor=e}},noZoom:{get:function(){return console.warn("THREE.OrbitControls: .noZoom has been deprecated. Use .enableZoom instead."),!this.enableZoom},set:function(e){console.warn("THREE.OrbitControls: .noZoom has been deprecated. Use .enableZoom instead."),this.enableZoom=!e}},noRotate:{get:function(){return console.warn("THREE.OrbitControls: .noRotate has been deprecated. Use .enableRotate instead."),!this.enableRotate},set:function(e){console.warn("THREE.OrbitControls: .noRotate has been deprecated. Use .enableRotate instead."),this.enableRotate=!e}},noPan:{get:function(){return console.warn("THREE.OrbitControls: .noPan has been deprecated. Use .enablePan instead."),!this.enablePan},set:function(e){console.warn("THREE.OrbitControls: .noPan has been deprecated. Use .enablePan instead."),this.enablePan=!e}},noKeys:{get:function(){return console.warn("THREE.OrbitControls: .noKeys has been deprecated. Use .enableKeys instead."),!this.enableKeys},set:function(e){console.warn("THREE.OrbitControls: .noKeys has been deprecated. Use .enableKeys instead."),this.enableKeys=!e}},staticMoving:{get:function(){return console.warn("THREE.OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead."),!this.constraint.enableDamping},set:function(e){console.warn("THREE.OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead."),this.constraint.enableDamping=!e}},dynamicDampingFactor:{get:function(){return console.warn("THREE.OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead."),this.constraint.dampingFactor},set:function(e){console.warn("THREE.OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead."),this.constraint.dampingFactor=e}}}),t},p=function e(){var t=e.SkyShader,n=new C.ShaderMaterial({fragmentShader:t.fragmentShader,vertexShader:t.vertexShader,uniforms:C.UniformsUtils.clone(t.uniforms),side:C.BackSide});C.Mesh.call(this,new C.BoxBufferGeometry(1,1,1),n)};function f(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}p.prototype=Object.create(C.Mesh.prototype),p.SkyShader={uniforms:{luminance:{value:1},turbidity:{value:2},rayleigh:{value:1},mieCoefficient:{value:.005},mieDirectionalG:{value:.8},sunPosition:{value:new C.Vector3}},vertexShader:["uniform vec3 sunPosition;","uniform float rayleigh;","uniform float turbidity;","uniform float mieCoefficient;","varying vec3 vWorldPosition;","varying vec3 vSunDirection;","varying float vSunfade;","varying vec3 vBetaR;","varying vec3 vBetaM;","varying float vSunE;","const vec3 up = vec3( 0.0, 1.0, 0.0 );","const float e = 2.71828182845904523536028747135266249775724709369995957;","const float pi = 3.141592653589793238462643383279502884197169;","const vec3 lambda = vec3( 680E-9, 550E-9, 450E-9 );","const vec3 totalRayleigh = vec3( 5.804542996261093E-6, 1.3562911419845635E-5, 3.0265902468824876E-5 );","const float v = 4.0;","const vec3 K = vec3( 0.686, 0.678, 0.666 );","const vec3 MieConst = vec3( 1.8399918514433978E14, 2.7798023919660528E14, 4.0790479543861094E14 );","const float cutoffAngle = 1.6110731556870734;","const float steepness = 1.5;","const float EE = 1000.0;","float sunIntensity( float zenithAngleCos ) {","\tzenithAngleCos = clamp( zenithAngleCos, -1.0, 1.0 );","\treturn EE * max( 0.0, 1.0 - pow( e, -( ( cutoffAngle - acos( zenithAngleCos ) ) / steepness ) ) );","}","vec3 totalMie( float T ) {","\tfloat c = ( 0.2 * T ) * 10E-18;","\treturn 0.434 * c * MieConst;","}","void main() {","\tvec4 worldPosition = modelMatrix * vec4( position, 1.0 );","\tvWorldPosition = worldPosition.xyz;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","\tgl_Position.z = gl_Position.w;","\tvSunDirection = normalize( sunPosition );","\tvSunE = sunIntensity( dot( vSunDirection, up ) );","\tvSunfade = 1.0 - clamp( 1.0 - exp( ( sunPosition.y / 450000.0 ) ), 0.0, 1.0 );","\tfloat rayleighCoefficient = rayleigh - ( 1.0 * ( 1.0 - vSunfade ) );","\tvBetaR = totalRayleigh * rayleighCoefficient;","\tvBetaM = totalMie( turbidity ) * mieCoefficient;","}"].join("\n"),fragmentShader:["varying vec3 vWorldPosition;","varying vec3 vSunDirection;","varying float vSunfade;","varying vec3 vBetaR;","varying vec3 vBetaM;","varying float vSunE;","uniform float luminance;","uniform float mieDirectionalG;","const vec3 cameraPos = vec3( 0.0, 0.0, 0.0 );","const float pi = 3.141592653589793238462643383279502884197169;","const float n = 1.0003;","const float N = 2.545E25;","const float rayleighZenithLength = 8.4E3;","const float mieZenithLength = 1.25E3;","const vec3 up = vec3( 0.0, 1.0, 0.0 );","const float sunAngularDiameterCos = 0.999956676946448443553574619906976478926848692873900859324;","const float THREE_OVER_SIXTEENPI = 0.05968310365946075;","const float ONE_OVER_FOURPI = 0.07957747154594767;","float rayleighPhase( float cosTheta ) {","\treturn THREE_OVER_SIXTEENPI * ( 1.0 + pow( cosTheta, 2.0 ) );","}","float hgPhase( float cosTheta, float g ) {","\tfloat g2 = pow( g, 2.0 );","\tfloat inverse = 1.0 / pow( 1.0 - 2.0 * g * cosTheta + g2, 1.5 );","\treturn ONE_OVER_FOURPI * ( ( 1.0 - g2 ) * inverse );","}","const float A = 0.15;","const float B = 0.50;","const float C = 0.10;","const float D = 0.20;","const float E = 0.02;","const float F = 0.30;","const float whiteScale = 1.0748724675633854;","vec3 Uncharted2Tonemap( vec3 x ) {","\treturn ( ( x * ( A * x + C * B ) + D * E ) / ( x * ( A * x + B ) + D * F ) ) - E / F;","}","void main() {","\tfloat zenithAngle = acos( max( 0.0, dot( up, normalize( vWorldPosition - cameraPos ) ) ) );","\tfloat inverse = 1.0 / ( cos( zenithAngle ) + 0.15 * pow( 93.885 - ( ( zenithAngle * 180.0 ) / pi ), -1.253 ) );","\tfloat sR = rayleighZenithLength * inverse;","\tfloat sM = mieZenithLength * inverse;","\tvec3 Fex = exp( -( vBetaR * sR + vBetaM * sM ) );","\tfloat cosTheta = dot( normalize( vWorldPosition - cameraPos ), vSunDirection );","\tfloat rPhase = rayleighPhase( cosTheta * 0.5 + 0.5 );","\tvec3 betaRTheta = vBetaR * rPhase;","\tfloat mPhase = hgPhase( cosTheta, mieDirectionalG );","\tvec3 betaMTheta = vBetaM * mPhase;","\tvec3 Lin = pow( vSunE * ( ( betaRTheta + betaMTheta ) / ( vBetaR + vBetaM ) ) * ( 1.0 - Fex ), vec3( 1.5 ) );","\tLin *= mix( vec3( 1.0 ), pow( vSunE * ( ( betaRTheta + betaMTheta ) / ( vBetaR + vBetaM ) ) * Fex, vec3( 1.0 / 2.0 ) ), clamp( pow( 1.0 - dot( up, vSunDirection ), 5.0 ), 0.0, 1.0 ) );","\tvec3 direction = normalize( vWorldPosition - cameraPos );","\tfloat theta = acos( direction.y ); // elevation --\x3e y-axis, [-pi/2, pi/2]","\tfloat phi = atan( direction.z, direction.x ); // azimuth --\x3e x-axis [-pi/2, pi/2]","\tvec2 uv = vec2( phi, theta ) / vec2( 2.0 * pi, pi ) + vec2( 0.5, 0.0 );","\tvec3 L0 = vec3( 0.1 ) * Fex;","\tfloat sundisk = smoothstep( sunAngularDiameterCos, sunAngularDiameterCos + 0.00002, cosTheta );","\tL0 += ( vSunE * 19000.0 * Fex ) * sundisk;","\tvec3 texColor = ( Lin + L0 ) * 0.04 + vec3( 0.0, 0.0003, 0.00075 );","\tvec3 curr = Uncharted2Tonemap( ( log2( 2.0 / pow( luminance, 4.0 ) ) ) * texColor );","\tvec3 color = curr * whiteScale;","\tvec3 retColor = pow( color, vec3( 1.0 / ( 1.2 + ( 1.2 * vSunfade ) ) ) );","\tgl_FragColor = vec4( retColor, 1.0 );","}"].join("\n")};var d=function(){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{current:"one",parent:null};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.stack=[e]}var e,n,r;return e=t,(n=[{key:"getLastChild",value:function(){return this.stack[this.stack.length-1]}},{key:"push",value:function(t){this.stack.some(function(e){return e.current===t.current})||this.stack.push(t)}},{key:"pop",value:function(){if(!(this.stack.length<=1))return this.stack.pop()}}])&&f(e.prototype,n),r&&f(e,r),t}(),v={},x=void 0,m=v;
/** @license zlib.js 2012 - imaya [ https://github.com/imaya/zlib.js ] The MIT License */function g(e,t){var n,r=e.split("."),a=m;!(r[0]in a)&&a.execScript&&a.execScript("var "+r[0]);for(;r.length&&(n=r.shift());)r.length||t===x?a=a[n]?a[n]:a[n]={}:a[n]=t}var A="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Uint32Array&&"undefined"!=typeof DataView;function T(e){var t,n,r,a,o,i,s,c,l,u,h=e.length,p=0,f=Number.POSITIVE_INFINITY;for(c=0;c<h;++c)e[c]>p&&(p=e[c]),e[c]<f&&(f=e[c]);for(t=1<<p,n=new(A?Uint32Array:Array)(t),r=1,a=0,o=2;r<=p;){for(c=0;c<h;++c)if(e[c]===r){for(s=a,l=i=0;l<r;++l)i=i<<1|1&s,s>>=1;for(u=r<<16|c,l=i;l<t;l+=o)n[l]=u;++a}++r,a<<=1,o<<=1}return[n,p,f]}function y(e,t){switch(this.g=[],this.h=32768,this.d=this.f=this.a=this.l=0,this.input=A?new Uint8Array(e):e,this.m=!1,this.i=P,this.r=!1,(t||(t={},0))&&(t.index&&(this.a=t.index),t.bufferSize&&(this.h=t.bufferSize),t.bufferType&&(this.i=t.bufferType),t.resize&&(this.r=t.resize)),this.i){case L:this.b=32768,this.c=new(A?Uint8Array:Array)(32768+this.h+258);break;case P:this.b=0,this.c=new(A?Uint8Array:Array)(this.h),this.e=this.z,this.n=this.v,this.j=this.w;break;default:throw Error("invalid inflate mode")}}var L=0,P=1,b=L,E=P;y.prototype.k=function(){for(;!this.m;){var e=W(this,3);switch(1&e&&(this.m=!0),e>>>=1){case 0:var t=this.input,n=this.a,r=this.c,a=this.b,o=t.length,i=x,s=r.length,c=x;if(this.d=this.f=0,o<=n+1)throw Error("invalid uncompressed block header: LEN");if(i=t[n++]|t[n++]<<8,o<=n+1)throw Error("invalid uncompressed block header: NLEN");if(i===~(t[n++]|t[n++]<<8))throw Error("invalid uncompressed block header: length verify");if(n+i>t.length)throw Error("input buffer is broken");switch(this.i){case L:for(;a+i>r.length;){if(i-=c=s-a,A)r.set(t.subarray(n,n+c),a),a+=c,n+=c;else for(;c--;)r[a++]=t[n++];this.b=a,r=this.e(),a=this.b}break;case P:for(;a+i>r.length;)r=this.e({p:2});break;default:throw Error("invalid inflate mode")}if(A)r.set(t.subarray(n,n+i),a),a+=i,n+=i;else for(;i--;)r[a++]=t[n++];this.a=n,this.b=a,this.c=r;break;case 1:this.j(H,X);break;case 2:var l,u,h,p,f=W(this,5)+257,d=W(this,5)+1,v=W(this,4)+4,m=new(A?Uint8Array:Array)(k.length),g=x,y=x,b=x,w=x,E=x;for(E=0;E<v;++E)m[k[E]]=W(this,3);if(!A)for(E=v,v=m.length;E<v;++E)m[k[E]]=0;for(l=T(m),g=new(A?Uint8Array:Array)(f+d),E=0,p=f+d;E<p;)switch(y=Z(this,l)){case 16:for(w=3+W(this,2);w--;)g[E++]=b;break;case 17:for(w=3+W(this,3);w--;)g[E++]=0;b=0;break;case 18:for(w=11+W(this,7);w--;)g[E++]=0;b=0;break;default:b=g[E++]=y}u=T(A?g.subarray(0,f):g.slice(0,f)),h=T(A?g.subarray(f):g.slice(f)),this.j(u,h);break;default:throw Error("unknown BTYPE: "+e)}}return this.n()};var _,I,S=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],k=A?new Uint16Array(S):S,M=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,258,258],O=A?new Uint16Array(M):M,R=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0],D=A?new Uint8Array(R):R,j=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],F=A?new Uint16Array(j):j,N=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],B=A?new Uint8Array(N):N,U=new(A?Uint8Array:Array)(288);for(_=0,I=U.length;_<I;++_)U[_]=_<=143?8:_<=255?9:_<=279?7:8;var z,V,H=T(U),G=new(A?Uint8Array:Array)(30);for(z=0,V=G.length;z<V;++z)G[z]=5;var X=T(G);function W(e,t){for(var n,r=e.f,a=e.d,o=e.input,i=e.a,s=o.length;a<t;){if(s<=i)throw Error("input buffer is broken");r|=o[i++]<<a,a+=8}return n=r&(1<<t)-1,e.f=r>>>t,e.d=a-t,e.a=i,n}function Z(e,t){for(var n,r,a=e.f,o=e.d,i=e.input,s=e.a,c=i.length,l=t[0],u=t[1];o<u&&!(c<=s);)a|=i[s++]<<o,o+=8;if(o<(r=(n=l[a&(1<<u)-1])>>>16))throw Error("invalid code length: "+r);return e.f=a>>r,e.d=o-r,e.a=s,65535&n}function Y(e,t){var n,r;switch(this.input=e,this.a=0,(t||(t={},0))&&(t.index&&(this.a=t.index),t.verify&&(this.A=t.verify)),n=e[this.a++],r=e[this.a++],15&n){case K:this.method=K;break;default:throw Error("unsupported compression method")}if(0!=((n<<8)+r)%31)throw Error("invalid fcheck flag:"+((n<<8)+r)%31);if(32&r)throw Error("fdict flag is not supported");this.q=new y(e,{index:this.a,bufferSize:t.bufferSize,bufferType:t.bufferType,resize:t.resize})}y.prototype.j=function(e,t){var n=this.c,r=this.b;this.o=e;for(var a,o,i,s,c=n.length-258;256!==(a=Z(this,e));)if(a<256)c<=r&&(this.b=r,n=this.e(),r=this.b),n[r++]=a;else for(s=O[o=a-257],0<D[o]&&(s+=W(this,D[o])),a=Z(this,t),i=F[a],0<B[a]&&(i+=W(this,B[a])),c<=r&&(this.b=r,n=this.e(),r=this.b);s--;)n[r]=n[r++-i];for(;8<=this.d;)this.d-=8,this.a--;this.b=r},y.prototype.w=function(e,t){var n=this.c,r=this.b;this.o=e;for(var a,o,i,s,c=n.length;256!==(a=Z(this,e));)if(a<256)c<=r&&(c=(n=this.e()).length),n[r++]=a;else for(s=O[o=a-257],0<D[o]&&(s+=W(this,D[o])),a=Z(this,t),i=F[a],0<B[a]&&(i+=W(this,B[a])),c<r+s&&(c=(n=this.e()).length);s--;)n[r]=n[r++-i];for(;8<=this.d;)this.d-=8,this.a--;this.b=r},y.prototype.e=function(){var e,t,n=new(A?Uint8Array:Array)(this.b-32768),r=this.b-32768,a=this.c;if(A)n.set(a.subarray(32768,n.length));else for(e=0,t=n.length;e<t;++e)n[e]=a[e+32768];if(this.g.push(n),this.l+=n.length,A)a.set(a.subarray(r,r+32768));else for(e=0;e<32768;++e)a[e]=a[r+e];return this.b=32768,a},y.prototype.z=function(e){var t,n,r,a=this.input.length/this.a+1|0,o=this.input,i=this.c;return e&&("number"==typeof e.p&&(a=e.p),"number"==typeof e.u&&(a+=e.u)),n=a<2?(r=(o.length-this.a)/this.o[2]/2*258|0)<i.length?i.length+r:i.length<<1:i.length*a,A?(t=new Uint8Array(n)).set(i):t=i,this.c=t},y.prototype.n=function(){var e,t,n,r,a,o=0,i=this.c,s=this.g,c=new(A?Uint8Array:Array)(this.l+(this.b-32768));if(0===s.length)return A?this.c.subarray(32768,this.b):this.c.slice(32768,this.b);for(t=0,n=s.length;t<n;++t)for(r=0,a=(e=s[t]).length;r<a;++r)c[o++]=e[r];for(t=32768,n=this.b;t<n;++t)c[o++]=i[t];return this.g=[],this.buffer=c},y.prototype.v=function(){var e,t=this.b;return A?this.r?(e=new Uint8Array(t)).set(this.c.subarray(0,t)):e=this.c.subarray(0,t):(this.c.length>t&&(this.c.length=t),e=this.c),this.buffer=e},Y.prototype.k=function(){var e,t,n=this.input;if(e=this.q.k(),this.a=this.q.a,this.A){t=(n[this.a++]<<24|n[this.a++]<<16|n[this.a++]<<8|n[this.a++])>>>0;var r=e;if("string"==typeof r){var a,o,i=r.split("");for(a=0,o=i.length;a<o;a++)i[a]=(255&i[a].charCodeAt(0))>>>0;r=i}for(var s,c=1,l=0,u=r.length,h=0;0<u;){for(u-=s=1024<u?1024:u;l+=c+=r[h++],--s;);c%=65521,l%=65521}if(t!==(l<<16|c)>>>0)throw Error("invalid adler-32 checksum")}return e};var K=8;g("Zlib.Inflate",Y),g("Zlib.Inflate.prototype.decompress",Y.prototype.k);var q,Q,$,J,ee={ADAPTIVE:E,BLOCK:b};if(Object.keys)q=Object.keys(ee);else for(Q in q=[],$=0,ee)q[$++]=Q;for($=0,J=q.length;$<J;++$)g("Zlib.Inflate.BufferType."+(Q=q[$]),ee[Q]);var te=v.Zlib;C.TGALoader=function(e){this.manager=void 0!==e?e:C.DefaultLoadingManager},C.TGALoader.prototype={constructor:C.TGALoader,load:function(e,t,n,r){var a=this,o=new C.Texture,i=new C.FileLoader(this.manager);return i.setResponseType("arraybuffer"),i.setPath(this.path),i.load(e,function(e){o.image=a.parse(e),o.needsUpdate=!0,void 0!==t&&t(o)},n,r),o},parse:function(e){e.length<19&&console.error("THREE.TGALoader: Not enough data to contain header.");var t=new Uint8Array(e),n=0,v={id_length:t[n++],colormap_type:t[n++],image_type:t[n++],colormap_index:t[n++]|t[n++]<<8,colormap_length:t[n++]|t[n++]<<8,colormap_size:t[n++],origin:[t[n++]|t[n++]<<8,t[n++]|t[n++]<<8],width:t[n++]|t[n++]<<8,height:t[n++]|t[n++]<<8,pixel_size:t[n++],flags:t[n++]};!function(e){switch(e.image_type){case 1:case 9:(256<e.colormap_length||24!==e.colormap_size||1!==e.colormap_type)&&console.error("THREE.TGALoader: Invalid type colormap data for indexed type.");break;case 2:case 3:case 10:case 11:e.colormap_type&&console.error("THREE.TGALoader: Invalid type colormap data for colormap type.");break;case 0:console.error("THREE.TGALoader: No data.");default:console.error('THREE.TGALoader: Invalid type "%s".',e.image_type)}(e.width<=0||e.height<=0)&&console.error("THREE.TGALoader: Invalid image size."),8!==e.pixel_size&&16!==e.pixel_size&&24!==e.pixel_size&&32!==e.pixel_size&&console.error('THREE.TGALoader: Invalid pixel size "%s".',e.pixel_size)}(v),v.id_length+n>e.length&&console.error("THREE.TGALoader: No data."),n+=v.id_length;var r=!1,a=!1,h=!1;switch(v.image_type){case 9:a=r=!0;break;case 1:a=!0;break;case 10:r=!0;break;case 2:break;case 11:h=r=!0;break;case 3:h=!0}var o="undefined"!=typeof OffscreenCanvas,i=o?new OffscreenCanvas(v.width,v.height):document.createElement("canvas");i.width=v.width,i.height=v.height;var s=i.getContext("2d"),c=s.createImageData(v.width,v.height),l=function(e,t,n,r,a){var o,i,s,c;if(i=n.pixel_size>>3,s=n.width*n.height*i,t&&(c=a.subarray(r,r+=n.colormap_length*(n.colormap_size>>3))),e){var l,u,h;o=new Uint8Array(s);for(var p=0,f=new Uint8Array(i);p<s;)if(u=1+(127&(l=a[r++])),128&l){for(h=0;h<i;++h)f[h]=a[r++];for(h=0;h<u;++h)o.set(f,p+h*i);p+=i*u}else{for(u*=i,h=0;h<u;++h)o[p+h]=a[r++];p+=u}}else o=a.subarray(r,r+=t?n.width*n.height:s);return{pixel_data:o,palettes:c}}(r,a,v,n,t);!function(e,t,n,r,a){var o,i,s,c,l,u;switch((48&v.flags)>>4){default:case 2:l=t,i=o=0,c=s=1,u=n;break;case 0:o=0,l=t,i=n-(s=1),u=c=-1;break;case 3:o=t-1,l=s=-1,i=0,c=1,u=n;break;case 1:o=t-1,i=n-1,u=c=l=s=-1}if(h)switch(v.pixel_size){case 8:!function(e,t,n,r,a,o,i,s){var c,l,u,h=0,p=v.width;for(u=t;u!==r;u+=n)for(l=a;l!==i;l+=o,h++)c=s[h],e[4*(l+p*u)+0]=c,e[4*(l+p*u)+1]=c,e[4*(l+p*u)+2]=c,e[4*(l+p*u)+3]=255}(e,i,c,u,o,s,l,r);break;case 16:!function(e,t,n,r,a,o,i,s){var c,l,u=0,h=v.width;for(l=t;l!==r;l+=n)for(c=a;c!==i;c+=o,u+=2)e[4*(c+h*l)+0]=s[u+0],e[4*(c+h*l)+1]=s[u+0],e[4*(c+h*l)+2]=s[u+0],e[4*(c+h*l)+3]=s[u+1]}(e,i,c,u,o,s,l,r);break;default:console.error("THREE.TGALoader: Format not supported.")}else switch(v.pixel_size){case 8:!function(e,t,n,r,a,o,i,s,c){var l,u,h,p=c,f=0,d=v.width;for(h=t;h!==r;h+=n)for(u=a;u!==i;u+=o,f++)l=s[f],e[4*(u+d*h)+3]=255,e[4*(u+d*h)+2]=p[3*l+0],e[4*(u+d*h)+1]=p[3*l+1],e[4*(u+d*h)+0]=p[3*l+2]}(e,i,c,u,o,s,l,r,a);break;case 16:!function(e,t,n,r,a,o,i,s){var c,l,u,h=0,p=v.width;for(u=t;u!==r;u+=n)for(l=a;l!==i;l+=o,h+=2)c=s[h+0]+(s[h+1]<<8),e[4*(l+p*u)+0]=(31744&c)>>7,e[4*(l+p*u)+1]=(992&c)>>2,e[4*(l+p*u)+2]=(31&c)>>3,e[4*(l+p*u)+3]=32768&c?0:255}(e,i,c,u,o,s,l,r);break;case 24:!function(e,t,n,r,a,o,i,s){var c,l,u=0,h=v.width;for(l=t;l!==r;l+=n)for(c=a;c!==i;c+=o,u+=3)e[4*(c+h*l)+3]=255,e[4*(c+h*l)+2]=s[u+0],e[4*(c+h*l)+1]=s[u+1],e[4*(c+h*l)+0]=s[u+2]}(e,i,c,u,o,s,l,r);break;case 32:!function(e,t,n,r,a,o,i,s){var c,l,u=0,h=v.width;for(l=t;l!==r;l+=n)for(c=a;c!==i;c+=o,u+=4)e[4*(c+h*l)+2]=s[u+0],e[4*(c+h*l)+1]=s[u+1],e[4*(c+h*l)+0]=s[u+2],e[4*(c+h*l)+3]=s[u+3]}(e,i,c,u,o,s,l,r);break;default:console.error("THREE.TGALoader: Format not supported.")}}(c.data,v.width,v.height,l.pixel_data,l.palettes);return s.putImageData(c,0,0),o?i.transferToImageBitmap():i},setPath:function(e){return this.path=e,this}};var ne={findSpan:function(e,t,n){var r=n.length-e-1;if(t>=n[r])return r-1;if(t<=n[e])return e;for(var a=e,o=r,i=Math.floor((a+o)/2);t<n[i]||t>=n[i+1];)t<n[i]?o=i:a=i,i=Math.floor((a+o)/2);return i},calcBasisFunctions:function(e,t,n,r){for(var a=[],o=[],i=[],s=a[0]=1;s<=n;++s){o[s]=t-r[e+1-s],i[s]=r[e+s]-t;for(var c=0,l=0;l<s;++l){var u=i[l+1],h=o[s-l],p=a[l]/(u+h);a[l]=c+u*p,c=h*p}a[s]=c}return a},calcBSplinePoint:function(e,t,n,r){for(var a=this.findSpan(e,r,t),o=this.calcBasisFunctions(a,r,e,t),i=new C.Vector4(0,0,0,0),s=0;s<=e;++s){var c=n[a-e+s],l=o[s],u=c.w*l;i.x+=c.x*u,i.y+=c.y*u,i.z+=c.z*u,i.w+=c.w*l}return i},calcBasisFunctionDerivatives:function(e,t,n,r,a){for(var o=[],i=0;i<=n;++i)o[i]=0;var s=[];for(i=0;i<=r;++i)s[i]=o.slice(0);var c=[];for(i=0;i<=n;++i)c[i]=o.slice(0);c[0][0]=1;for(var l=o.slice(0),u=o.slice(0),h=1;h<=n;++h){l[h]=t-a[e+1-h],u[h]=a[e+h]-t;for(var p=0,f=0;f<h;++f){var d=u[f+1],v=l[h-f];c[h][f]=d+v;var m=c[f][h-1]/c[h][f];c[f][h]=p+d*m,p=v*m}c[h][h]=p}for(h=0;h<=n;++h)s[0][h]=c[h][n];for(f=0;f<=n;++f){var g=0,y=1,b=[];for(i=0;i<=n;++i)b[i]=o.slice(0);for(var w=b[0][0]=1;w<=r;++w){var E=0,x=f-w,A=n-w;w<=f&&(b[y][0]=b[g][0]/c[A+1][x],E=b[y][0]*c[x][A]);var T=f-1<=A?w-1:n-f;for(h=-1<=x?1:-x;h<=T;++h)b[y][h]=(b[g][h]-b[g][h-1])/c[A+1][x+h],E+=b[y][h]*c[x+h][A];f<=A&&(b[y][w]=-b[g][w-1]/c[A+1][f],E+=b[y][w]*c[f][A]),s[w][f]=E;h=g;g=y,y=h}}for(f=n,w=1;w<=r;++w){for(h=0;h<=n;++h)s[w][h]*=f;f*=n-w}return s},calcBSplineDerivatives:function(e,t,n,r,a){for(var o=a<e?a:e,i=[],s=this.findSpan(e,r,t),c=this.calcBasisFunctionDerivatives(s,r,e,o,t),l=[],u=0;u<n.length;++u){var h=(f=n[u].clone()).w;f.x*=h,f.y*=h,f.z*=h,l[u]=f}for(var p=0;p<=o;++p){for(var f=l[s-e].clone().multiplyScalar(c[p][0]),d=1;d<=e;++d)f.add(l[s-e+d].clone().multiplyScalar(c[p][d]));i[p]=f}for(p=o+1;p<=a+1;++p)i[p]=new C.Vector4(0,0,0);return i},calcKoverI:function(e,t){for(var n=1,r=2;r<=e;++r)n*=r;var a=1;for(r=2;r<=t;++r)a*=r;for(r=2;r<=e-t;++r)a*=r;return n/a},calcRationalCurveDerivatives:function(e){for(var t=e.length,n=[],r=[],a=0;a<t;++a){var o=e[a];n[a]=new C.Vector3(o.x,o.y,o.z),r[a]=o.w}for(var i=[],s=0;s<t;++s){var c=n[s].clone();for(a=1;a<=s;++a)c.sub(i[s-a].clone().multiplyScalar(this.calcKoverI(s,a)*r[a]));i[s]=c.divideScalar(r[0])}return i},calcNURBSDerivatives:function(e,t,n,r,a){var o=this.calcBSplineDerivatives(e,t,n,r,a);return this.calcRationalCurveDerivatives(o)},calcSurfacePoint:function(e,t,n,r,a,o,i,s){for(var c=this.findSpan(e,o,n),l=this.findSpan(t,i,r),u=this.calcBasisFunctions(c,o,e,n),h=this.calcBasisFunctions(l,i,t,r),p=[],f=0;f<=t;++f){p[f]=new C.Vector4(0,0,0,0);for(var d=0;d<=e;++d){var v=a[c-e+d][l-t+f].clone(),m=v.w;v.x*=m,v.y*=m,v.z*=m,p[f].add(v.multiplyScalar(u[d]))}}var g=new C.Vector4(0,0,0,0);for(f=0;f<=t;++f)g.add(p[f].multiplyScalar(h[f]));g.divideScalar(g.w),s.set(g.x,g.y,g.z)}},re=function(e,t,n,r,a){C.Curve.call(this),this.degree=e,this.knots=t,this.controlPoints=[],this.startKnot=r||0,this.endKnot=a||this.knots.length-1;for(var o=0;o<n.length;++o){var i=n[o];this.controlPoints[o]=new C.Vector4(i.x,i.y,i.z,i.w)}};function ae(e){return(ae="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}((re.prototype=Object.create(C.Curve.prototype)).constructor=re).prototype.getPoint=function(e){var t=this.knots[this.startKnot]+e*(this.knots[this.endKnot]-this.knots[this.startKnot]),n=ne.calcBSplinePoint(this.degree,this.knots,this.controlPoints,t);return 1!=n.w&&n.divideScalar(n.w),new C.Vector3(n.x,n.y,n.z)},re.prototype.getTangent=function(e){var t=this.knots[0]+e*(this.knots[this.knots.length-1]-this.knots[0]),n=ne.calcNURBSDerivatives(this.degree,this.knots,this.controlPoints,t,1)[1].clone();return n.normalize(),n};var oe=function(){var h,p,f;function e(e){this.manager=void 0!==e?e:C.DefaultLoadingManager}function o(e){this.textureLoader=e}function i(){}function s(){}function c(){}function l(){}function u(e,t){this.dv=new DataView(e),this.offset=0,this.littleEndian=void 0===t||t}function d(){}function v(e){var t=e.match(/FBXVersion: (\d+)/);if(t)return parseInt(t[1]);throw new Error("THREE.FBXLoader: Cannot find the version number for the file given.")}function m(e){return e/46186158e3}e.prototype={constructor:e,crossOrigin:"anonymous",load:function(t,n,e,r){var a=this,o=void 0===a.path?C.LoaderUtils.extractUrlBase(t):a.path,i=new C.FileLoader(this.manager);i.setPath(a.path),i.setResponseType("arraybuffer"),i.load(t,function(e){try{n(a.parse(e,o))}catch(e){setTimeout(function(){r&&r(e),a.manager.itemError(t)},0)}},e,r)},setPath:function(e){return this.path=e,this},setResourcePath:function(e){return this.resourcePath=e,this},setCrossOrigin:function(e){return this.crossOrigin=e,this},parse:function(e,t){if(a="Kaydara FBX Binary  \0",(r=e).byteLength>=a.length&&a===E(r,0,a.length))h=(new l).parse(e);else{var n=E(e);if(!function(n){var e=["K","a","y","d","a","r","a","\\","F","B","X","\\","B","i","n","a","r","y","\\","\\"],r=0;function t(e){var t=n[e-1];return n=n.slice(r+e),r++,t}for(var a=0;a<e.length;++a){var o=t(1);if(o===e[a])return!1}return!0}(n))throw new Error("THREE.FBXLoader: Unknown format.");if(v(n)<7e3)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+v(n));h=(new c).parse(n)}var r,a;return new o(new C.TextureLoader(this.manager).setPath(this.resourcePath||t).setCrossOrigin(this.crossOrigin)).parse(h)}},o.prototype={constructor:o,parse:function(){p=this.parseConnections();var e=this.parseImages(),t=this.parseTextures(e),n=this.parseMaterials(t),r=this.parseDeformers(),a=(new i).parse(r);return this.parseScene(r,a,n),f},parseConnections:function(){var i=new Map;"Connections"in h&&h.Connections.connections.forEach(function(e){var t=e[0],n=e[1],r=e[2];i.has(t)||i.set(t,{parents:[],children:[]});var a={ID:n,relationship:r};i.get(t).parents.push(a),i.has(n)||i.set(n,{parents:[],children:[]});var o={ID:t,relationship:r};i.get(n).children.push(o)});return i},parseImages:function(){var e={},t={};if("Video"in h.Objects){var n=h.Objects.Video;for(var r in n){var a=n[r];if(e[c=parseInt(r)]=a.RelativeFilename||a.Filename,"Content"in a){var o=a.Content instanceof ArrayBuffer&&0<a.Content.byteLength,i="string"==typeof a.Content&&""!==a.Content;if(o||i){var s=this.parseImage(n[r]);t[a.RelativeFilename||a.Filename]=s}}}}for(var c in e){var l=e[c];void 0!==t[l]?e[c]=t[l]:e[c]=e[c].split("\\").pop()}return e},parseImage:function(e){var t,n=e.Content,r=e.RelativeFilename||e.Filename,a=r.slice(r.lastIndexOf(".")+1).toLowerCase();switch(a){case"bmp":t="image/bmp";break;case"jpg":case"jpeg":t="image/jpeg";break;case"png":t="image/png";break;case"tif":t="image/tiff";break;case"tga":return void console.warn("FBXLoader: TGALoader is required to load TGA textures");default:return void console.warn('FBXLoader: Image type "'+a+'" is not supported.')}if("string"==typeof n)return"data:"+t+";base64,"+n;var o=new Uint8Array(n);return window.URL.createObjectURL(new Blob([o],{type:t}))},parseTextures:function(e){var t=new Map;if("Texture"in h.Objects){var n=h.Objects.Texture;for(var r in n){var a=this.parseTexture(n[r],e);t.set(parseInt(r),a)}}return t},parseTexture:function(e,t){var n=this.loadTexture(e,t);n.ID=e.id,n.name=e.attrName;var r=e.WrapModeU,a=e.WrapModeV,o=void 0!==r?r.value:0,i=void 0!==a?a.value:0;if(n.wrapS=0===o?C.RepeatWrapping:C.ClampToEdgeWrapping,n.wrapT=0===i?C.RepeatWrapping:C.ClampToEdgeWrapping,"Scaling"in e){var s=e.Scaling.value;n.repeat.x=s[0],n.repeat.y=s[1]}return n},loadTexture:function(e,t){var n,r,a=this.textureLoader.path,o=p.get(e.id).children;void 0!==o&&0<o.length&&void 0!==t[o[0].ID]&&(0!==(n=t[o[0].ID]).indexOf("blob:")&&0!==n.indexOf("data:")||this.textureLoader.setPath(void 0));var i=e.FileName.slice(-3).toLowerCase();if("tga"===i){var s=C.Loader.Handlers.get(".tga");r=null===s?(console.warn("FBXLoader: TGALoader not found, creating empty placeholder texture for",n),new C.Texture):s.load(n)}else r="psd"===i?(console.warn("FBXLoader: PSD textures are not supported, creating empty placeholder texture for",n),new C.Texture):this.textureLoader.load(n);return this.textureLoader.setPath(a),r},parseMaterials:function(e){var t=new Map;if("Material"in h.Objects){var n=h.Objects.Material;for(var r in n){var a=this.parseMaterial(n[r],e);null!==a&&t.set(parseInt(r),a)}}return t},parseMaterial:function(e,t){var n=e.id,r=e.attrName,a=e.ShadingModel;if("object"===ae(a)&&(a=a.value),!p.has(n))return null;var o,i=this.parseParameters(e,t,n);switch(a.toLowerCase()){case"phong":o=new C.MeshPhongMaterial;break;case"lambert":o=new C.MeshLambertMaterial;break;default:console.warn('THREE.FBXLoader: unknown material type "%s". Defaulting to MeshPhongMaterial.',a),o=new C.MeshPhongMaterial}return o.setValues(i),o.name=r,o},parseParameters:function(e,n,t){var r={};e.BumpFactor&&(r.bumpScale=e.BumpFactor.value),e.Diffuse?r.color=(new C.Color).fromArray(e.Diffuse.value):e.DiffuseColor&&"Color"===e.DiffuseColor.type&&(r.color=(new C.Color).fromArray(e.DiffuseColor.value)),e.DisplacementFactor&&(r.displacementScale=e.DisplacementFactor.value),e.Emissive?r.emissive=(new C.Color).fromArray(e.Emissive.value):e.EmissiveColor&&"Color"===e.EmissiveColor.type&&(r.emissive=(new C.Color).fromArray(e.EmissiveColor.value)),e.EmissiveFactor&&(r.emissiveIntensity=parseFloat(e.EmissiveFactor.value)),e.Opacity&&(r.opacity=parseFloat(e.Opacity.value)),r.opacity<1&&(r.transparent=!0),e.ReflectionFactor&&(r.reflectivity=e.ReflectionFactor.value),e.Shininess&&(r.shininess=e.Shininess.value),e.Specular?r.specular=(new C.Color).fromArray(e.Specular.value):e.SpecularColor&&"Color"===e.SpecularColor.type&&(r.specular=(new C.Color).fromArray(e.SpecularColor.value));var a=this;return p.get(t).children.forEach(function(e){var t=e.relationship;switch(t){case"Bump":r.bumpMap=a.getTexture(n,e.ID);break;case"Maya|TEX_ao_map":r.aoMap=a.getTexture(n,e.ID);break;case"DiffuseColor":case"Maya|TEX_color_map":r.map=a.getTexture(n,e.ID);break;case"DisplacementColor":r.displacementMap=a.getTexture(n,e.ID);break;case"EmissiveColor":r.emissiveMap=a.getTexture(n,e.ID);break;case"NormalMap":case"Maya|TEX_normal_map":r.normalMap=a.getTexture(n,e.ID);break;case"ReflectionColor":r.envMap=a.getTexture(n,e.ID),r.envMap.mapping=C.EquirectangularReflectionMapping;break;case"SpecularColor":r.specularMap=a.getTexture(n,e.ID);break;case"TransparentColor":r.alphaMap=a.getTexture(n,e.ID),r.transparent=!0;break;case"AmbientColor":case"ShininessExponent":case"SpecularFactor":case"VectorDisplacementColor":default:console.warn("THREE.FBXLoader: %s map is not supported in three.js, skipping texture.",t)}}),r},getTexture:function(e,t){return"LayeredTexture"in h.Objects&&t in h.Objects.LayeredTexture&&(console.warn("THREE.FBXLoader: layered textures are not supported in three.js. Discarding all but first layer."),t=p.get(t).children[0].ID),e.get(t)},parseDeformers:function(){var e={},t={};if("Deformer"in h.Objects){var n=h.Objects.Deformer;for(var r in n){var a=n[r],o=p.get(parseInt(r));if("Skin"===a.attrType){var i=this.parseSkeleton(o,n);i.ID=r,1<o.parents.length&&console.warn("THREE.FBXLoader: skeleton attached to more than one geometry is not supported."),i.geometryID=o.parents[0].ID,e[r]=i}else if("BlendShape"===a.attrType){var s={id:r};s.rawTargets=this.parseMorphTargets(o,n),s.id=r,1<o.parents.length&&console.warn("THREE.FBXLoader: morph target attached to more than one geometry is not supported."),t[r]=s}}}return{skeletons:e,morphTargets:t}},parseSkeleton:function(e,r){var a=[];return e.children.forEach(function(e){var t=r[e.ID];if("Cluster"===t.attrType){var n={ID:e.ID,indices:[],weights:[],transformLink:(new C.Matrix4).fromArray(t.TransformLink.a)};"Indexes"in t&&(n.indices=t.Indexes.a,n.weights=t.Weights.a),a.push(n)}}),{rawBones:a,bones:[]}},parseMorphTargets:function(e,t){for(var n=[],r=0;r<e.children.length;r++){var a=e.children[r],o=t[a.ID],i={name:o.attrName,initialWeight:o.DeformPercent,id:o.id,fullWeights:o.FullWeights.a};if("BlendShapeChannel"!==o.attrType)return;i.geoID=p.get(parseInt(a.ID)).children.filter(function(e){return void 0===e.relationship})[0].ID,n.push(i)}return n},parseScene:function(e,t,n){f=new C.Group;var r=this.parseModels(e.skeletons,t,n),a=h.Objects.Model,o=this;r.forEach(function(n){var e=a[n.ID];o.setLookAtProperties(n,e),p.get(n.ID).parents.forEach(function(e){var t=r.get(e.ID);void 0!==t&&t.add(n)}),null===n.parent&&f.add(n)}),this.bindSkeleton(e.skeletons,t,r),this.createAmbientLight(),this.setupMorphMaterials(),f.traverse(function(e){if(e.userData.transformData){e.parent&&(e.userData.transformData.parentMatrixWorld=e.parent.matrix);var t=y(e.userData.transformData);e.applyMatrix(t)}});var i=(new s).parse();1===f.children.length&&f.children[0].isGroup&&(f.children[0].animations=i,f=f.children[0]),f.animations=i},parseModels:function(e,t,n){var r=new Map,a=h.Objects.Model;for(var o in a){var i=parseInt(o),s=a[o],c=p.get(i),l=this.buildSkeleton(c,e,i,s.attrName);if(!l){switch(s.attrType){case"Camera":l=this.createCamera(c);break;case"Light":l=this.createLight(c);break;case"Mesh":l=this.createMesh(c,t,n);break;case"NurbsCurve":l=this.createCurve(c,t);break;case"LimbNode":case"Root":l=new C.Bone;break;case"Null":default:l=new C.Group}l.name=C.PropertyBinding.sanitizeNodeName(s.attrName),l.ID=i}this.getTransformData(l,s),r.set(i,l)}return r},buildSkeleton:function(e,t,o,i){var s=null;return e.parents.forEach(function(r){for(var e in t){var a=t[e];a.rawBones.forEach(function(e,t){if(e.ID===r.ID){var n=s;(s=new C.Bone).matrixWorld.copy(e.transformLink),s.name=C.PropertyBinding.sanitizeNodeName(i),s.ID=o,a.bones[t]=s,null!==n&&s.add(n)}})}}),s},createCamera:function(e){var t,n;if(e.children.forEach(function(e){var t=h.Objects.NodeAttribute[e.ID];void 0!==t&&(n=t)}),void 0===n)t=new C.Object3D;else{var r=0;void 0!==n.CameraProjectionType&&1===n.CameraProjectionType.value&&(r=1);var a=1;void 0!==n.NearPlane&&(a=n.NearPlane.value/1e3);var o=1e3;void 0!==n.FarPlane&&(o=n.FarPlane.value/1e3);var i=window.innerWidth,s=window.innerHeight;void 0!==n.AspectWidth&&void 0!==n.AspectHeight&&(i=n.AspectWidth.value,s=n.AspectHeight.value);var c=i/s,l=45;void 0!==n.FieldOfView&&(l=n.FieldOfView.value);var u=n.FocalLength?n.FocalLength.value:null;switch(r){case 0:t=new C.PerspectiveCamera(l,c,a,o),null!==u&&t.setFocalLength(u);break;case 1:t=new C.OrthographicCamera(-i/2,i/2,s/2,-s/2,a,o);break;default:console.warn("THREE.FBXLoader: Unknown camera type "+r+"."),t=new C.Object3D}}return t},createLight:function(e){var t,n;if(e.children.forEach(function(e){var t=h.Objects.NodeAttribute[e.ID];void 0!==t&&(n=t)}),void 0===n)t=new C.Object3D;else{var r;r=void 0===n.LightType?0:n.LightType.value;var a=16777215;void 0!==n.Color&&(a=(new C.Color).fromArray(n.Color.value));var o=void 0===n.Intensity?1:n.Intensity.value/100;void 0!==n.CastLightOnObject&&0===n.CastLightOnObject.value&&(o=0);var i=0;void 0!==n.FarAttenuationEnd&&(i=void 0!==n.EnableFarAttenuation&&0===n.EnableFarAttenuation.value?0:n.FarAttenuationEnd.value);switch(r){case 0:t=new C.PointLight(a,o,i,1);break;case 1:t=new C.DirectionalLight(a,o);break;case 2:var s=Math.PI/3;void 0!==n.InnerAngle&&(s=C.Math.degToRad(n.InnerAngle.value));var c=0;void 0!==n.OuterAngle&&(c=C.Math.degToRad(n.OuterAngle.value),c=Math.max(c,1)),t=new C.SpotLight(a,o,i,s,c,1);break;default:console.warn("THREE.FBXLoader: Unknown light type "+n.LightType.value+", defaulting to a PointLight."),t=new C.PointLight(a,o)}void 0!==n.CastShadows&&1===n.CastShadows.value&&(t.castShadow=!0)}return t},createMesh:function(e,t,n){var r,a=null,o=null,i=[];return e.children.forEach(function(e){t.has(e.ID)&&(a=t.get(e.ID)),n.has(e.ID)&&i.push(n.get(e.ID))}),1<i.length?o=i:0<i.length?o=i[0]:(o=new C.MeshPhongMaterial({color:13421772}),i.push(o)),"color"in a.attributes&&i.forEach(function(e){e.vertexColors=C.VertexColors}),a.FBX_Deformer?(i.forEach(function(e){e.skinning=!0}),(r=new C.SkinnedMesh(a,o)).normalizeSkinWeights()):r=new C.Mesh(a,o),r},createCurve:function(e,n){var t=e.children.reduce(function(e,t){return n.has(t.ID)&&(e=n.get(t.ID)),e},null),r=new C.LineBasicMaterial({color:3342591,linewidth:1});return new C.Line(t,r)},getTransformData:function(e,t){var n={};"InheritType"in t&&(n.inheritType=parseInt(t.InheritType.value)),n.eulerOrder="RotationOrder"in t?b(t.RotationOrder.value):"ZYX","Lcl_Translation"in t&&(n.translation=t.Lcl_Translation.value),"PreRotation"in t&&(n.preRotation=t.PreRotation.value),"Lcl_Rotation"in t&&(n.rotation=t.Lcl_Rotation.value),"PostRotation"in t&&(n.postRotation=t.PostRotation.value),"Lcl_Scaling"in t&&(n.scale=t.Lcl_Scaling.value),"ScalingOffset"in t&&(n.scalingOffset=t.ScalingOffset.value),"ScalingPivot"in t&&(n.scalingPivot=t.ScalingPivot.value),"RotationOffset"in t&&(n.rotationOffset=t.RotationOffset.value),"RotationPivot"in t&&(n.rotationPivot=t.RotationPivot.value),e.userData.transformData=n},setLookAtProperties:function(r,e){"LookAtProperty"in e&&p.get(r.ID).children.forEach(function(e){if("LookAtProperty"===e.relationship){var t=h.Objects.Model[e.ID];if("Lcl_Translation"in t){var n=t.Lcl_Translation.value;void 0!==r.target?(r.target.position.fromArray(n),f.add(r.target)):r.lookAt((new C.Vector3).fromArray(n))}}})},bindSkeleton:function(e,n,r){var a=this.parsePoseNodes();for(var t in e){var o=e[t];p.get(parseInt(o.ID)).parents.forEach(function(e){if(n.has(e.ID)){var t=e.ID;p.get(t).parents.forEach(function(e){r.has(e.ID)&&r.get(e.ID).bind(new C.Skeleton(o.bones),a[e.ID])})}})}},parsePoseNodes:function(){var t={};if("Pose"in h.Objects){var e=h.Objects.Pose;for(var n in e)if("BindPose"===e[n].attrType){var r=e[n].PoseNode;Array.isArray(r)?r.forEach(function(e){t[e.Node]=(new C.Matrix4).fromArray(e.Matrix.a)}):t[r.Node]=(new C.Matrix4).fromArray(r.Matrix.a)}}return t},createAmbientLight:function(){if("GlobalSettings"in h&&"AmbientColor"in h.GlobalSettings){var e=h.GlobalSettings.AmbientColor.value,t=e[0],n=e[1],r=e[2];if(0!==t||0!==n||0!==r){var a=new C.Color(t,n,r);f.add(new C.AmbientLight(a,1))}}},setupMorphMaterials:function(){var r=this;f.traverse(function(n){n.isMesh&&n.geometry.morphAttributes.position&&n.geometry.morphAttributes.position.length&&(Array.isArray(n.material)?n.material.forEach(function(e,t){r.setupMorphMaterial(n,e,t)}):r.setupMorphMaterial(n,n.material))})},setupMorphMaterial:function(e,t,n){var r=e.uuid,a=t.uuid,o=!1;if(f.traverse(function(t){t.isMesh&&(Array.isArray(t.material)?t.material.forEach(function(e){e.uuid===a&&t.uuid!==r&&(o=!0)}):t.material.uuid===a&&t.uuid!==r&&(o=!0))}),!0===o){var i=t.clone();i.morphTargets=!0,void 0===n?e.material=i:e.material[n]=i}else t.morphTargets=!0}},i.prototype={constructor:i,parse:function(e){var t=new Map;if("Geometry"in h.Objects){var n=h.Objects.Geometry;for(var r in n){var a=p.get(parseInt(r)),o=this.parseGeometry(a,n[r],e);t.set(parseInt(r),o)}}return t},parseGeometry:function(e,t,n){switch(t.attrType){case"Mesh":return this.parseMeshGeometry(e,t,n);case"NurbsCurve":return this.parseNurbsGeometry(t)}},parseMeshGeometry:function(e,t,n){var r=n.skeletons,a=n.morphTargets,o=e.parents.map(function(e){return h.Objects.Model[e.ID]});if(0!==o.length){var i=e.children.reduce(function(e,t){return void 0!==r[t.ID]&&(e=r[t.ID]),e},null),s=e.children.reduce(function(e,t){return void 0!==a[t.ID]&&(e=a[t.ID]),e},null),c=o[0],l={};"RotationOrder"in c&&(l.eulerOrder=b(c.RotationOrder.value)),"InheritType"in c&&(l.inheritType=parseInt(c.InheritType.value)),"GeometricTranslation"in c&&(l.translation=c.GeometricTranslation.value),"GeometricRotation"in c&&(l.rotation=c.GeometricRotation.value),"GeometricScaling"in c&&(l.scale=c.GeometricScaling.value);var u=y(l);return this.genGeometry(t,i,s,u)}},genGeometry:function(e,t,n,r){var a=new C.BufferGeometry;e.attrName&&(a.name=e.attrName);var o=this.parseGeoNode(e,t),i=this.genBuffers(o),s=new C.Float32BufferAttribute(i.vertex,3);if(r.applyToBufferAttribute(s),a.addAttribute("position",s),0<i.colors.length&&a.addAttribute("color",new C.Float32BufferAttribute(i.colors,3)),t&&(a.addAttribute("skinIndex",new C.Uint16BufferAttribute(i.weightsIndices,4)),a.addAttribute("skinWeight",new C.Float32BufferAttribute(i.vertexWeights,4)),a.FBX_Deformer=t),0<i.normal.length){var c=new C.Float32BufferAttribute(i.normal,3);(new C.Matrix3).getNormalMatrix(r).applyToBufferAttribute(c),a.addAttribute("normal",c)}if(i.uvs.forEach(function(e,t){var n="uv"+(t+1).toString();0===t&&(n="uv"),a.addAttribute(n,new C.Float32BufferAttribute(i.uvs[t],2))}),o.material&&"AllSame"!==o.material.mappingType){var l=i.materialIndex[0],u=0;if(i.materialIndex.forEach(function(e,t){e!==l&&(a.addGroup(u,t-u,l),l=e,u=t)}),0<a.groups.length){var h=a.groups[a.groups.length-1],p=h.start+h.count;p!==i.materialIndex.length&&a.addGroup(p,i.materialIndex.length-p,l)}0===a.groups.length&&a.addGroup(0,i.materialIndex.length,i.materialIndex[0])}return this.addMorphTargets(a,e,n,r),a},parseGeoNode:function(e,t){var a={};if(a.vertexPositions=void 0!==e.Vertices?e.Vertices.a:[],a.vertexIndices=void 0!==e.PolygonVertexIndex?e.PolygonVertexIndex.a:[],e.LayerElementColor&&(a.color=this.parseVertexColors(e.LayerElementColor[0])),e.LayerElementMaterial&&(a.material=this.parseMaterialIndices(e.LayerElementMaterial[0])),e.LayerElementNormal&&(a.normal=this.parseNormals(e.LayerElementNormal[0])),e.LayerElementUV){a.uv=[];for(var n=0;e.LayerElementUV[n];)a.uv.push(this.parseUVs(e.LayerElementUV[n])),n++}return a.weightTable={},null!==t&&(a.skeleton=t).rawBones.forEach(function(n,r){n.indices.forEach(function(e,t){void 0===a.weightTable[e]&&(a.weightTable[e]=[]),a.weightTable[e].push({id:r,weight:n.weights[t]})})}),a},genBuffers:function(u){var h={vertex:[],normal:[],colors:[],uvs:[],materialIndex:[],vertexWeights:[],weightsIndices:[]},p=0,f=0,d=!1,v=[],m=[],g=[],y=[],b=[],w=[],E=this;return u.vertexIndices.forEach(function(r,a){var e=!1;r<0&&(r^=-1,e=!0);var n=[],t=[];if(v.push(3*r,3*r+1,3*r+2),u.color){var o=x(a,p,r,u.color);g.push(o[0],o[1],o[2])}if(u.skeleton){if(void 0!==u.weightTable[r]&&u.weightTable[r].forEach(function(e){t.push(e.weight),n.push(e.id)}),4<t.length){d||(console.warn("THREE.FBXLoader: Vertex has more than 4 skinning weights assigned to vertex. Deleting additional weights."),d=!0);var i=[0,0,0,0],s=[0,0,0,0];t.forEach(function(e,t){var a=e,o=n[t];s.forEach(function(e,t,n){if(e<a){n[t]=a,a=e;var r=i[t];i[t]=o,o=r}})}),n=i,t=s}for(;t.length<4;)t.push(0),n.push(0);for(var c=0;c<4;++c)b.push(t[c]),w.push(n[c])}if(u.normal){o=x(a,p,r,u.normal);m.push(o[0],o[1],o[2])}if(u.material&&"AllSame"!==u.material.mappingType)var l=x(a,p,r,u.material)[0];u.uv&&u.uv.forEach(function(e,t){var n=x(a,p,r,e);void 0===y[t]&&(y[t]=[]),y[t].push(n[0]),y[t].push(n[1])}),f++,e&&(E.genFace(h,u,v,l,m,g,y,b,w,f),p++,f=0,v=[],m=[],g=[],y=[],b=[],w=[])}),h},genFace:function(n,e,t,r,a,o,i,s,c,l){for(var u=2;u<l;u++)n.vertex.push(e.vertexPositions[t[0]]),n.vertex.push(e.vertexPositions[t[1]]),n.vertex.push(e.vertexPositions[t[2]]),n.vertex.push(e.vertexPositions[t[3*(u-1)]]),n.vertex.push(e.vertexPositions[t[3*(u-1)+1]]),n.vertex.push(e.vertexPositions[t[3*(u-1)+2]]),n.vertex.push(e.vertexPositions[t[3*u]]),n.vertex.push(e.vertexPositions[t[3*u+1]]),n.vertex.push(e.vertexPositions[t[3*u+2]]),e.skeleton&&(n.vertexWeights.push(s[0]),n.vertexWeights.push(s[1]),n.vertexWeights.push(s[2]),n.vertexWeights.push(s[3]),n.vertexWeights.push(s[4*(u-1)]),n.vertexWeights.push(s[4*(u-1)+1]),n.vertexWeights.push(s[4*(u-1)+2]),n.vertexWeights.push(s[4*(u-1)+3]),n.vertexWeights.push(s[4*u]),n.vertexWeights.push(s[4*u+1]),n.vertexWeights.push(s[4*u+2]),n.vertexWeights.push(s[4*u+3]),n.weightsIndices.push(c[0]),n.weightsIndices.push(c[1]),n.weightsIndices.push(c[2]),n.weightsIndices.push(c[3]),n.weightsIndices.push(c[4*(u-1)]),n.weightsIndices.push(c[4*(u-1)+1]),n.weightsIndices.push(c[4*(u-1)+2]),n.weightsIndices.push(c[4*(u-1)+3]),n.weightsIndices.push(c[4*u]),n.weightsIndices.push(c[4*u+1]),n.weightsIndices.push(c[4*u+2]),n.weightsIndices.push(c[4*u+3])),e.color&&(n.colors.push(o[0]),n.colors.push(o[1]),n.colors.push(o[2]),n.colors.push(o[3*(u-1)]),n.colors.push(o[3*(u-1)+1]),n.colors.push(o[3*(u-1)+2]),n.colors.push(o[3*u]),n.colors.push(o[3*u+1]),n.colors.push(o[3*u+2])),e.material&&"AllSame"!==e.material.mappingType&&(n.materialIndex.push(r),n.materialIndex.push(r),n.materialIndex.push(r)),e.normal&&(n.normal.push(a[0]),n.normal.push(a[1]),n.normal.push(a[2]),n.normal.push(a[3*(u-1)]),n.normal.push(a[3*(u-1)+1]),n.normal.push(a[3*(u-1)+2]),n.normal.push(a[3*u]),n.normal.push(a[3*u+1]),n.normal.push(a[3*u+2])),e.uv&&e.uv.forEach(function(e,t){void 0===n.uvs[t]&&(n.uvs[t]=[]),n.uvs[t].push(i[t][0]),n.uvs[t].push(i[t][1]),n.uvs[t].push(i[t][2*(u-1)]),n.uvs[t].push(i[t][2*(u-1)+1]),n.uvs[t].push(i[t][2*u]),n.uvs[t].push(i[t][2*u+1])})},addMorphTargets:function(n,r,e,a){if(null!==e){n.morphAttributes.position=[];var o=this;e.rawTargets.forEach(function(e){var t=h.Objects.Geometry[e.geoID];void 0!==t&&o.genMorphGeometry(n,r,t,a,e.name)})}},genMorphGeometry:function(e,t,n,r,a){var o=new C.BufferGeometry;n.attrName&&(o.name=n.attrName);for(var i=void 0!==t.PolygonVertexIndex?t.PolygonVertexIndex.a:[],s=void 0!==t.Vertices?t.Vertices.a.slice():[],c=void 0!==n.Vertices?n.Vertices.a:[],l=void 0!==n.Indexes?n.Indexes.a:[],u=0;u<l.length;u++){var h=3*l[u];s[h]+=c[3*u],s[h+1]+=c[3*u+1],s[h+2]+=c[3*u+2]}var p={vertexIndices:i,vertexPositions:s},f=this.genBuffers(p),d=new C.Float32BufferAttribute(f.vertex,3);d.name=a||n.attrName,r.applyToBufferAttribute(d),e.morphAttributes.position.push(d)},parseNormals:function(e){var t=e.MappingInformationType,n=e.ReferenceInformationType,r=e.Normals.a,a=[];return"IndexToDirect"===n&&("NormalIndex"in e?a=e.NormalIndex.a:"NormalsIndex"in e&&(a=e.NormalsIndex.a)),{dataSize:3,buffer:r,indices:a,mappingType:t,referenceType:n}},parseUVs:function(e){var t=e.MappingInformationType,n=e.ReferenceInformationType,r=e.UV.a,a=[];return"IndexToDirect"===n&&(a=e.UVIndex.a),{dataSize:2,buffer:r,indices:a,mappingType:t,referenceType:n}},parseVertexColors:function(e){var t=e.MappingInformationType,n=e.ReferenceInformationType,r=e.Colors.a,a=[];return"IndexToDirect"===n&&(a=e.ColorIndex.a),{dataSize:4,buffer:r,indices:a,mappingType:t,referenceType:n}},parseMaterialIndices:function(e){var t=e.MappingInformationType,n=e.ReferenceInformationType;if("NoMappingInformation"===t)return{dataSize:1,buffer:[0],indices:[0],mappingType:"AllSame",referenceType:n};for(var r=e.Materials.a,a=[],o=0;o<r.length;++o)a.push(o);return{dataSize:1,buffer:r,indices:a,mappingType:t,referenceType:n}},parseNurbsGeometry:function(e){if(void 0===re)return console.error("THREE.FBXLoader: The loader relies on NURBSCurve for any nurbs present in the model. Nurbs will show up as empty geometry."),new C.BufferGeometry;var t=parseInt(e.Order);if(isNaN(t))return console.error("THREE.FBXLoader: Invalid Order %s given for geometry ID: %s",e.Order,e.id),new C.BufferGeometry;for(var n,r,a=t-1,o=e.KnotVector.a,i=[],s=e.Points.a,c=0,l=s.length;c<l;c+=4)i.push((new C.Vector4).fromArray(s,c));if("Closed"===e.Form)i.push(i[0]);else if("Periodic"===e.Form){n=a,r=o.length-1-n;for(c=0;c<a;++c)i.push(i[c])}var u=new re(a,o,i,n,r).getPoints(7*i.length),h=new Float32Array(3*u.length);u.forEach(function(e,t){e.toArray(h,3*t)});var p=new C.BufferGeometry;return p.addAttribute("position",new C.BufferAttribute(h,3)),p}},s.prototype={constructor:s,parse:function(){var e=[],t=this.parseClips();if(void 0!==t)for(var n in t){var r=t[n],a=this.addClip(r);e.push(a)}return e},parseClips:function(){if(void 0!==h.Objects.AnimationCurve){var e=this.parseAnimationCurveNodes();this.parseAnimationCurves(e);var t=this.parseAnimationLayers(e);return this.parseAnimStacks(t)}},parseAnimationCurveNodes:function(){var e=h.Objects.AnimationCurveNode,t=new Map;for(var n in e){var r=e[n];if(null!==r.attrName.match(/S|R|T|DeformPercent/)){var a={id:r.id,attr:r.attrName,curves:{}};t.set(a.id,a)}}return t},parseAnimationCurves:function(e){var t=h.Objects.AnimationCurve;for(var n in t){var r={id:t[n].id,times:t[n].KeyTime.a.map(m),values:t[n].KeyValueFloat.a},a=p.get(r.id);if(void 0!==a){var o=a.parents[0].ID,i=a.parents[0].relationship;i.match(/X/)?e.get(o).curves.x=r:i.match(/Y/)?e.get(o).curves.y=r:i.match(/Z/)?e.get(o).curves.z=r:i.match(/d|DeformPercent/)&&e.has(o)&&(e.get(o).curves.morph=r)}}},parseAnimationLayers:function(l){var e=h.Objects.AnimationLayer,t=new Map;for(var n in e){var u=[],r=p.get(parseInt(n));if(void 0!==r)r.children.forEach(function(e,t){if(l.has(e.ID)){var n=l.get(e.ID);if(void 0!==n.curves.x||void 0!==n.curves.y||void 0!==n.curves.z){if(void 0===u[t])if(void 0!==(c=p.get(e.ID).parents.filter(function(e){return void 0!==e.relationship})[0].ID)){var r=h.Objects.Model[c.toString()],a={modelName:C.PropertyBinding.sanitizeNodeName(r.attrName),ID:r.id,initialPosition:[0,0,0],initialRotation:[0,0,0],initialScale:[1,1,1]};f.traverse(function(e){e.ID===r.id&&(a.transform=e.matrix,e.userData.transformData&&(a.eulerOrder=e.userData.transformData.eulerOrder))}),a.transform||(a.transform=new C.Matrix4),"PreRotation"in r&&(a.preRotation=r.PreRotation.value),"PostRotation"in r&&(a.postRotation=r.PostRotation.value),u[t]=a}u[t]&&(u[t][n.attr]=n)}else if(void 0!==n.curves.morph){if(void 0===u[t]){var o=p.get(e.ID).parents.filter(function(e){return void 0!==e.relationship})[0].ID,i=p.get(o).parents[0].ID,s=p.get(i).parents[0].ID,c=p.get(s).parents[0].ID;r=h.Objects.Model[c],a={modelName:C.PropertyBinding.sanitizeNodeName(r.attrName),morphName:h.Objects.Deformer[o].attrName};u[t]=a}u[t][n.attr]=n}}}),t.set(parseInt(n),u)}return t},parseAnimStacks:function(e){var t=h.Objects.AnimationStack,n={};for(var r in t){var a=p.get(parseInt(r)).children;1<a.length&&console.warn("THREE.FBXLoader: Encountered an animation stack with multiple layers, this is currently not supported. Ignoring subsequent layers.");var o=e.get(a[0].ID);n[r]={name:t[r].attrName,layer:o}}return n},addClip:function(e){var t=[],n=this;return e.layer.forEach(function(e){t=t.concat(n.generateTracks(e))}),new C.AnimationClip(e.name,-1,t)},generateTracks:function(e){var t=[],n=new C.Vector3,r=new C.Quaternion,a=new C.Vector3;if(e.transform&&e.transform.decompose(n,r,a),n=n.toArray(),r=(new C.Euler).setFromQuaternion(r,e.eulerOrder).toArray(),a=a.toArray(),void 0!==e.T&&0<Object.keys(e.T.curves).length){var o=this.generateVectorTrack(e.modelName,e.T.curves,n,"position");void 0!==o&&t.push(o)}if(void 0!==e.R&&0<Object.keys(e.R.curves).length){var i=this.generateRotationTrack(e.modelName,e.R.curves,r,e.preRotation,e.postRotation,e.eulerOrder);void 0!==i&&t.push(i)}if(void 0!==e.S&&0<Object.keys(e.S.curves).length){var s=this.generateVectorTrack(e.modelName,e.S.curves,a,"scale");void 0!==s&&t.push(s)}if(void 0!==e.DeformPercent){var c=this.generateMorphTrack(e);void 0!==c&&t.push(c)}return t},generateVectorTrack:function(e,t,n,r){var a=this.getTimesForAllAxes(t),o=this.getKeyframeTrackValues(a,t,n);return new C.VectorKeyframeTrack(e+"."+r,a,o)},generateRotationTrack:function(e,t,n,r,a,o){void 0!==t.x&&(this.interpolateRotations(t.x),t.x.values=t.x.values.map(C.Math.degToRad)),void 0!==t.y&&(this.interpolateRotations(t.y),t.y.values=t.y.values.map(C.Math.degToRad)),void 0!==t.z&&(this.interpolateRotations(t.z),t.z.values=t.z.values.map(C.Math.degToRad));var i=this.getTimesForAllAxes(t),s=this.getKeyframeTrackValues(i,t,n);void 0!==r&&((r=r.map(C.Math.degToRad)).push(o),r=(new C.Euler).fromArray(r),r=(new C.Quaternion).setFromEuler(r)),void 0!==a&&((a=a.map(C.Math.degToRad)).push(o),a=(new C.Euler).fromArray(a),a=(new C.Quaternion).setFromEuler(a).inverse());for(var c=new C.Quaternion,l=new C.Euler,u=[],h=0;h<s.length;h+=3)l.set(s[h],s[h+1],s[h+2],o),c.setFromEuler(l),void 0!==r&&c.premultiply(r),void 0!==a&&c.multiply(a),c.toArray(u,h/3*4);return new C.QuaternionKeyframeTrack(e+".quaternion",i,u)},generateMorphTrack:function(e){var t=e.DeformPercent.curves.morph,n=t.values.map(function(e){return e/100}),r=f.getObjectByName(e.modelName).morphTargetDictionary[e.morphName];return new C.NumberKeyframeTrack(e.modelName+".morphTargetInfluences["+r+"]",t.times,n)},getTimesForAllAxes:function(e){var t=[];return void 0!==e.x&&(t=t.concat(e.x.times)),void 0!==e.y&&(t=t.concat(e.y.times)),void 0!==e.z&&(t=t.concat(e.z.times)),t=t.sort(function(e,t){return e-t}).filter(function(e,t,n){return n.indexOf(e)==t})},getKeyframeTrackValues:function(e,a,t){var o=t,i=[],s=-1,c=-1,l=-1;return e.forEach(function(e){if(a.x&&(s=a.x.times.indexOf(e)),a.y&&(c=a.y.times.indexOf(e)),a.z&&(l=a.z.times.indexOf(e)),-1!==s){var t=a.x.values[s];i.push(t),o[0]=t}else i.push(o[0]);if(-1!==c){var n=a.y.values[c];i.push(n),o[1]=n}else i.push(o[1]);if(-1!==l){var r=a.z.values[l];i.push(r),o[2]=r}else i.push(o[2])}),i},interpolateRotations:function(e){for(var t=1;t<e.values.length;t++){var n=e.values[t-1],r=e.values[t]-n,a=Math.abs(r);if(180<=a){for(var o=a/180,i=r/o,s=n+i,c=e.times[t-1],l=(e.times[t]-c)/o,u=c+l,h=[],p=[];u<e.times[t];)h.push(u),u+=l,p.push(s),s+=i;e.times=A(e.times,t,h),e.values=A(e.values,t,p)}}}},c.prototype={constructor:c,getPrevNode:function(){return this.nodeStack[this.currentIndent-2]},getCurrentNode:function(){return this.nodeStack[this.currentIndent-1]},getCurrentProp:function(){return this.currentProp},pushStack:function(e){this.nodeStack.push(e),this.currentIndent+=1},popStack:function(){this.nodeStack.pop(),this.currentIndent-=1},setCurrentProp:function(e,t){this.currentProp=e,this.currentPropName=t},parse:function(e){this.currentIndent=0,this.allNodes=new d,this.nodeStack=[],this.currentProp=[],this.currentPropName="";var s=this,c=e.split(/[\r\n]+/);return c.forEach(function(e,t){var n=e.match(/^[\s\t]*;/),r=e.match(/^[\s\t]*$/);if(!n&&!r){var a=e.match("^\\t{"+s.currentIndent+"}(\\w+):(.*){",""),o=e.match("^\\t{"+s.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)"),i=e.match("^\\t{"+(s.currentIndent-1)+"}}");a?s.parseNodeBegin(e,a):o?s.parseNodeProperty(e,o,c[++t]):i?s.popStack():e.match(/^[^\s\t}]/)&&s.parseNodePropertyContinued(e)}}),this.allNodes},parseNodeBegin:function(e,t){var n=t[1].trim().replace(/^"/,"").replace(/"$/,""),r=t[2].split(",").map(function(e){return e.trim().replace(/^"/,"").replace(/"$/,"")}),a={name:n},o=this.parseNodeAttr(r),i=this.getCurrentNode();0===this.currentIndent?this.allNodes.add(n,a):n in i?("PoseNode"===n?i.PoseNode.push(a):void 0!==i[n].id&&(i[n]={},i[n][i[n].id]=i[n]),""!==o.id&&(i[n][o.id]=a)):"number"==typeof o.id?(i[n]={},i[n][o.id]=a):"Properties70"!==n&&(i[n]="PoseNode"===n?[a]:a),"number"==typeof o.id&&(a.id=o.id),""!==o.name&&(a.attrName=o.name),""!==o.type&&(a.attrType=o.type),this.pushStack(a)},parseNodeAttr:function(e){var t=e[0];""!==e[0]&&(t=parseInt(e[0]),isNaN(t)&&(t=e[0]));var n="",r="";return 1<e.length&&(n=e[1].replace(/^(\w+)::/,""),r=e[2]),{id:t,name:n,type:r}},parseNodeProperty:function(e,t,n){var r=t[1].replace(/^"/,"").replace(/"$/,"").trim(),a=t[2].replace(/^"/,"").replace(/"$/,"").trim();"Content"===r&&","===a&&(a=n.replace(/"/g,"").replace(/,$/,"").trim());var o=this.getCurrentNode();if("Properties70"!==o.name){if("C"===r){var i=a.split(",").slice(1),s=parseInt(i[0]),c=parseInt(i[1]),l=a.split(",").slice(3);r="connections",function(e,t){for(var n=0,r=e.length,a=t.length;n<a;n++,r++)e[r]=t[n]}(a=[s,c],l=l.map(function(e){return e.trim().replace(/^"/,"")})),void 0===o[r]&&(o[r]=[])}"Node"===r&&(o.id=a),r in o&&Array.isArray(o[r])?o[r].push(a):"a"!==r?o[r]=a:o.a=a,this.setCurrentProp(o,r),"a"===r&&","!==a.slice(-1)&&(o.a=w(a))}else this.parseNodeSpecialProperty(e,r,a)},parseNodePropertyContinued:function(e){var t=this.getCurrentNode();t.a+=e,","!==e.slice(-1)&&(t.a=w(t.a))},parseNodeSpecialProperty:function(e,t,n){var r=n.split('",').map(function(e){return e.trim().replace(/^\"/,"").replace(/\s/,"_")}),a=r[0],o=r[1],i=r[2],s=r[3],c=r[4];switch(o){case"int":case"enum":case"bool":case"ULongLong":case"double":case"Number":case"FieldOfView":c=parseFloat(c);break;case"Color":case"ColorRGB":case"Vector3D":case"Lcl_Translation":case"Lcl_Rotation":case"Lcl_Scaling":c=w(c)}this.getPrevNode()[a]={type:o,type2:i,flag:s,value:c},this.setCurrentProp(this.getPrevNode(),a)}},l.prototype={constructor:l,parse:function(e){var t=new u(e);t.skip(23);var n=t.getUint32();console.log("THREE.FBXLoader: FBX binary version: "+n);for(var r=new d;!this.endOfContent(t);){var a=this.parseNode(t,n);null!==a&&r.add(a.name,a)}return r},endOfContent:function(e){return e.size()%16==0?(e.getOffset()+160+16&-16)>=e.size():e.getOffset()+160+16>=e.size()},parseNode:function(e,t){var n={},r=7500<=t?e.getUint64():e.getUint32(),a=7500<=t?e.getUint64():e.getUint32(),o=(7500<=t?e.getUint64():e.getUint32(),e.getUint8()),i=e.getString(o);if(0===r)return null;for(var s=[],c=0;c<a;c++)s.push(this.parseProperty(e));var l=0<s.length?s[0]:"",u=1<s.length?s[1]:"",h=2<s.length?s[2]:"";for(n.singleProperty=1===a&&e.getOffset()===r;r>e.getOffset();){var p=this.parseNode(e,t);null!==p&&this.parseSubNode(i,n,p)}return n.propertyList=s,"number"==typeof l&&(n.id=l),""!==u&&(n.attrName=u),""!==h&&(n.attrType=h),""!==i&&(n.name=i),n},parseSubNode:function(e,t,n){if(!0===n.singleProperty){var r=n.propertyList[0];Array.isArray(r)?(t[n.name]=n).a=r:t[n.name]=r}else if("Connections"===e&&"C"===n.name){var a=[];n.propertyList.forEach(function(e,t){0!==t&&a.push(e)}),void 0===t.connections&&(t.connections=[]),t.connections.push(a)}else if("Properties70"===n.name){Object.keys(n).forEach(function(e){t[e]=n[e]})}else if("Properties70"===e&&"P"===n.name){var o,i=n.propertyList[0],s=n.propertyList[1],c=n.propertyList[2],l=n.propertyList[3];0===i.indexOf("Lcl ")&&(i=i.replace("Lcl ","Lcl_")),0===s.indexOf("Lcl ")&&(s=s.replace("Lcl ","Lcl_")),o="Color"===s||"ColorRGB"===s||"Vector"===s||"Vector3D"===s||0===s.indexOf("Lcl_")?[n.propertyList[4],n.propertyList[5],n.propertyList[6]]:n.propertyList[4],t[i]={type:s,type2:c,flag:l,value:o}}else void 0===t[n.name]?"number"==typeof n.id?(t[n.name]={},t[n.name][n.id]=n):t[n.name]=n:"PoseNode"===n.name?(Array.isArray(t[n.name])||(t[n.name]=[t[n.name]]),t[n.name].push(n)):void 0===t[n.name][n.id]&&(t[n.name][n.id]=n)},parseProperty:function(e){var t=e.getString(1);switch(t){case"C":return e.getBoolean();case"D":return e.getFloat64();case"F":return e.getFloat32();case"I":return e.getInt32();case"L":return e.getInt64();case"R":var n=e.getUint32();return e.getArrayBuffer(n);case"S":n=e.getUint32();return e.getString(n);case"Y":return e.getInt16();case"b":case"c":case"d":case"f":case"i":case"l":var r=e.getUint32(),a=e.getUint32(),o=e.getUint32();if(0===a)switch(t){case"b":case"c":return e.getBooleanArray(r);case"d":return e.getFloat64Array(r);case"f":return e.getFloat32Array(r);case"i":return e.getInt32Array(r);case"l":return e.getInt64Array(r)}void 0===te&&console.error("THREE.FBXLoader: External library Inflate.min.js required, obtain or import from https://github.com/imaya/zlib.js");var i=new u(new te.Inflate(new Uint8Array(e.getArrayBuffer(o))).decompress().buffer);switch(t){case"b":case"c":return i.getBooleanArray(r);case"d":return i.getFloat64Array(r);case"f":return i.getFloat32Array(r);case"i":return i.getInt32Array(r);case"l":return i.getInt64Array(r)}default:throw new Error("THREE.FBXLoader: Unknown property type "+t)}}},u.prototype={constructor:u,getOffset:function(){return this.offset},size:function(){return this.dv.buffer.byteLength},skip:function(e){this.offset+=e},getBoolean:function(){return 1==(1&this.getUint8())},getBooleanArray:function(e){for(var t=[],n=0;n<e;n++)t.push(this.getBoolean());return t},getUint8:function(){var e=this.dv.getUint8(this.offset);return this.offset+=1,e},getInt16:function(){var e=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,e},getInt32:function(){var e=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,e},getInt32Array:function(e){for(var t=[],n=0;n<e;n++)t.push(this.getInt32());return t},getUint32:function(){var e=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,e},getInt64:function(){var e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),2147483648&t?(t=4294967295&~t,4294967295===(e=4294967295&~e)&&(t=t+1&4294967295),-(4294967296*t+(e=e+1&4294967295))):4294967296*t+e},getInt64Array:function(e){for(var t=[],n=0;n<e;n++)t.push(this.getInt64());return t},getUint64:function(){var e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),4294967296*t+e},getFloat32:function(){var e=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e},getFloat32Array:function(e){for(var t=[],n=0;n<e;n++)t.push(this.getFloat32());return t},getFloat64:function(){var e=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e},getFloat64Array:function(e){for(var t=[],n=0;n<e;n++)t.push(this.getFloat64());return t},getArrayBuffer:function(e){var t=this.dv.buffer.slice(this.offset,this.offset+e);return this.offset+=e,t},getString:function(e){for(var t=[],n=0;n<e;n++)t[n]=this.getUint8();var r=t.indexOf(0);return 0<=r&&(t=t.slice(0,r)),C.LoaderUtils.decodeText(new Uint8Array(t))}},d.prototype={constructor:d,add:function(e,t){this[e]=t}};var g=[];function x(e,t,n,r){var a;switch(r.mappingType){case"ByPolygonVertex":a=e;break;case"ByPolygon":a=t;break;case"ByVertice":a=n;break;case"AllSame":a=r.indices[0];break;default:console.warn("THREE.FBXLoader: unknown attribute mapping type "+r.mappingType)}"IndexToDirect"===r.referenceType&&(a=r.indices[a]);var o=a*r.dataSize,i=o+r.dataSize;return function(e,t,n,r){for(var a=n,o=0;a<r;a++,o++)e[o]=t[a];return e}(g,r.buffer,o,i)}var P=new C.Euler,_=new C.Vector3;function y(e){var t,n=new C.Matrix4,r=new C.Matrix4,a=new C.Matrix4,o=new C.Matrix4,i=new C.Matrix4,s=new C.Matrix4,c=new C.Matrix4,l=new C.Matrix4,u=new C.Matrix4,h=new C.Matrix4,p=new C.Matrix4,f=e.inheritType?e.inheritType:0;(e.translation&&n.setPosition(_.fromArray(e.translation)),e.preRotation)&&((t=e.preRotation.map(C.Math.degToRad)).push(e.eulerOrder),r.makeRotationFromEuler(P.fromArray(t)));e.rotation&&((t=e.rotation.map(C.Math.degToRad)).push(e.eulerOrder),a.makeRotationFromEuler(P.fromArray(t)));e.postRotation&&((t=e.postRotation.map(C.Math.degToRad)).push(e.eulerOrder),o.makeRotationFromEuler(P.fromArray(t)));e.scale&&i.scale(_.fromArray(e.scale)),e.scalingOffset&&c.setPosition(_.fromArray(e.scalingOffset)),e.scalingPivot&&s.setPosition(_.fromArray(e.scalingPivot)),e.rotationOffset&&l.setPosition(_.fromArray(e.rotationOffset)),e.rotationPivot&&u.setPosition(_.fromArray(e.rotationPivot)),e.parentMatrixWorld&&(h=e.parentMatrixWorld);var d=r.multiply(a).multiply(o),v=new C.Matrix4;h.extractRotation(v);var m,g,y,b,w=new C.Matrix4;if(w.copyPosition(h),y=w.getInverse(w).multiply(h),g=v.getInverse(v).multiply(y),m=i,0===f)b=v.multiply(d).multiply(g).multiply(m);else if(1===f)b=v.multiply(g).multiply(d).multiply(m);else{var E=(new C.Matrix4).copy(i),x=g.multiply(E.getInverse(E));b=v.multiply(d).multiply(x).multiply(m)}var A=n.multiply(l).multiply(u).multiply(r).multiply(a).multiply(o).multiply(u.getInverse(u)).multiply(c).multiply(s).multiply(i).multiply(s.getInverse(s)),T=(new C.Matrix4).copyPosition(A),L=h.multiply(T);return p.copyPosition(L),A=p.multiply(b)}function b(e){var t=["ZYX","YZX","XZY","ZXY","YXZ","XYZ"];return 6===(e=e||0)?(console.warn("THREE.FBXLoader: unsupported Euler Order: Spherical XYZ. Animations and rotations may be incorrect."),t[0]):t[e]}function w(e){return e.split(",").map(function(e){return parseFloat(e)})}function E(e,t,n){return void 0===t&&(t=0),void 0===n&&(n=e.byteLength),C.LoaderUtils.decodeText(new Uint8Array(e,t,n))}function A(e,t,n){return e.slice(0,t).concat(n).concat(e.slice(t))}return e}();function ie(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var se=function(){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.self=e,this.loader=new oe}var e,n,r;return e=t,(n=[{key:"load",value:function(n){var r=this;return new Promise(function(t){r.loader.load(n,function(e){e.scale.set(w.obj.globalScale,w.obj.globalScale,w.obj.globalScale),r.self.setCastShadowAndReceiveShadow(e),r.mixer=e.mixer=new C.AnimationMixer(e),r.mixer.clipAction(e.animations[0]).play(),r.self.scene.add(e),window.__HMF__[n]=e,window.__HMF__[n].instance=r,t(e)})})}},{key:"update",value:function(e){this.mixer&&this.mixer.update(e)}}])&&ie(e.prototype,n),r&&ie(e,r),t}(),ce=function(e){this.manager=void 0!==e?e:C.DefaultLoadingManager};function le(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}ce.prototype={constructor:ce,load:function(e,t,n,r){var a=this,o=new C.FileLoader(a.manager);o.setPath(a.path),o.setResponseType("arraybuffer"),o.load(e,function(e){try{t(a.parse(e))}catch(e){r&&r(e)}},n,r)},setPath:function(e){return this.path=e,this},parse:function(e){function a(e,t,n){for(var r=0,a=e.length;r<a;r++)if(e[r]!==t.getUint8(n+r,!1))return!1;return!0}var t,n=function(e){if("string"!=typeof e)return e;for(var t=new Uint8Array(e.length),n=0;n<e.length;n++)t[n]=255&e.charCodeAt(n);return t.buffer||t}(e);return function(e){var t;if(84+50*(t=new DataView(e)).getUint32(80,!0)===t.byteLength)return!0;for(var n=[115,111,108,105,100],r=0;r<5;r++)if(a(n,t,r))return!1;return!0}(n)?function(e){for(var t,n,r,a,o,i,s,c,l=new DataView(e),u=l.getUint32(80,!0),h=!1,p=0;p<70;p++)1129270351==l.getUint32(p,!1)&&82==l.getUint8(p+4)&&61==l.getUint8(p+5)&&(h=!0,a=[],o=l.getUint8(p+6)/255,i=l.getUint8(p+7)/255,s=l.getUint8(p+8)/255,c=l.getUint8(p+9)/255);for(var f=new C.BufferGeometry,d=[],v=[],m=0;m<u;m++){var g=84+50*m,y=l.getFloat32(g,!0),b=l.getFloat32(g+4,!0),w=l.getFloat32(g+8,!0);if(h){var E=l.getUint16(g+48,!0);r=0==(32768&E)?(t=(31&E)/31,n=(E>>5&31)/31,(E>>10&31)/31):(t=o,n=i,s)}for(var x=1;x<=3;x++){var A=g+12*x;d.push(l.getFloat32(A,!0)),d.push(l.getFloat32(A+4,!0)),d.push(l.getFloat32(A+8,!0)),v.push(y,b,w),h&&a.push(t,n,r)}}return f.addAttribute("position",new C.BufferAttribute(new Float32Array(d),3)),f.addAttribute("normal",new C.BufferAttribute(new Float32Array(v),3)),h&&(f.addAttribute("color",new C.BufferAttribute(new Float32Array(a),3)),f.hasColors=!0,f.alpha=c),f}(n):function(e){for(var t,n=new C.BufferGeometry,r=/facet([\s\S]*?)endfacet/g,a=0,o=/[\s]+([+-]?(?:\d*)(?:\.\d*)?(?:[eE][+-]?\d+)?)/.source,i=new RegExp("vertex"+o+o+o,"g"),s=new RegExp("normal"+o+o+o,"g"),c=[],l=[],u=new C.Vector3;null!==(t=r.exec(e));){for(var h=0,p=0,f=t[0];null!==(t=s.exec(f));)u.x=parseFloat(t[1]),u.y=parseFloat(t[2]),u.z=parseFloat(t[3]),p++;for(;null!==(t=i.exec(f));)c.push(parseFloat(t[1]),parseFloat(t[2]),parseFloat(t[3])),l.push(u.x,u.y,u.z),h++;1!==p&&console.error("THREE.STLLoader: Something isn't right with the normal of face number "+a),3!==h&&console.error("THREE.STLLoader: Something isn't right with the vertices of face number "+a),a++}return n.addAttribute("position",new C.Float32BufferAttribute(c,3)),n.addAttribute("normal",new C.Float32BufferAttribute(l,3)),n}("string"!=typeof(t=e)?C.LoaderUtils.decodeText(new Uint8Array(t)):t)}};var ue=function(){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.self=e,this.loader=new ce}var e,n,r;return e=t,(n=[{key:"load",value:function(e){var a=this;return new Promise(function(r){a.loader.load(e,function(e){var t=new C.MeshPhongMaterial({color:16733491,specular:1118481,shininess:200}),n=new C.Mesh(e,t);n.position.set(0,0,0),n.rotation.set(-Math.PI/2,0,0),n.scale.set(w.obj.globalScale,w.obj.globalScale,w.obj.globalScale),a.self.setCastShadowAndReceiveShadow(e),n.castShadow=!0,n.receiveShadow=!0,a.self.scene.add(n),r(n)})})}}])&&le(e.prototype,n),r&&le(e,r),t}(),he=n(2);function pe(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var fe=function(){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.self=e,this.objLoader=new he.OBJLoader,this.mtlLoader=new he.MTLLoader}var e,n,r;return e=t,(n=[{key:"load",value:function(n,r,a){var o=this;return this.mtlLoader.setTexturePath(n.substring(0,n.lastIndexOf("/")+1)),new Promise(function(t){o.mtlLoader.load("".concat(n,".mtl"),function(e){o.objLoader.setMaterials(e),o.objLoader.load("".concat(n,".obj"),function(e){o.self.scene.add(e),e.scale.set(r||w.obj.globalScale,r||w.obj.globalScale,r||w.obj.globalScale),e.userData.level=a,o.self.setCastShadowAndReceiveShadow(e),window.__HMF__[n]=e,t(e)},function(e){if(e.lengthComputable){var t=e.loaded/e.total*100;o.self.container.querySelector("#loading").innerHTML="Loading ".concat(t.toFixed(1))}})})})}}])&&pe(e.prototype,n),r&&pe(e,r),t}();var de=function e(t,n){var r=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);var a=new dat.GUI;this.camera=t.camera.threeCamera,this.controls=t.threeControls,this.light=t.light,t.scene.getObjectByName("building_1");var o=a.addFolder("Camera"),i=o.add(w.camera,"fov",0,180).name("Camera FOV");i.onChange(function(e){r.controls.enableRotate=!1,r.camera.fov=e}),i.onFinishChange(function(){r.camera.updateProjectionMatrix(),r.controls.enableRotate=!0});var s=o.add(w.camera,"aspect",0,4).name("Camera Aspect");s.onChange(function(e){r.controls.enableRotate=!1,r.camera.aspect=e}),s.onFinishChange(function(){r.camera.updateProjectionMatrix(),r.controls.enableRotate=!0}),o.addColor(w.fog,"color").name("Fog Color").onChange(function(e){t.scene.fog.color.setHex(e)});var c=o.add(w.fog,"near",0,.01).name("Fog Near");c.onChange(function(e){r.controls.enableRotate=!1,t.scene.fog.density=e}),c.onFinishChange(function(){r.controls.enableRotate=!0});var l=a.addFolder("Controls");l.add(w.controls,"autoRotate").name("Auto Rotate").onChange(function(e){r.controls.autoRotate=e});var u=l.add(w.controls,"autoRotateSpeed",-1,1).name("Rotation Speed");u.onChange(function(e){r.controls.enableRotate=!1,r.controls.autoRotateSpeed=e}),u.onFinishChange(function(){r.controls.enableRotate=!0});var h=a.addFolder("Ambient Light");h.add(w.ambientLight,"enabled").name("Enabled").onChange(function(e){r.light.ambientLight.visible=e}),h.addColor(w.ambientLight,"color").name("Color").onChange(function(e){r.light.ambientLight.color.setHex(e)});var p=a.addFolder("Spot Light");p.add(w.spotLight,"enabled").name("Enabled").onChange(function(e){r.light.spotLight.visible=e}),p.addColor(w.spotLight,"color").name("Color").onChange(function(e){r.light.spotLight.color.setHex(e)}),p.add(w.spotLight,"distance").name("distance").onChange(function(e){r.light.spotLight.distance=e}),p.add(w.spotLight,"angle",0,180).name("angle").onChange(function(e){r.light.spotLight.angle=e}),p.add(w.spotLight.position,"x",-400,400).name("position.x").onChange(function(e){r.light.spotLight.position.x=e}),p.add(w.spotLight.position,"y",-400,400).name("position.y").onChange(function(e){r.light.spotLight.position.y=e}),p.add(w.spotLight.position,"z",-400,400).name("position.z").onChange(function(e){r.light.spotLight.position.z=e}),p.add(w.spotLight,"helperEnabled").name("helperEnabled").onChange(function(e){r.light.spotLightHelper.visible=!0})};function ve(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function me(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var ge=["building","villa","floor_common","room","parking","barrier_gate_out","barrier_gate_in","charging_pile","camera","access_control_machine"],ye=["building","floor"],be=function(){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.container=e,this.initRouter(),this.initScene(),this.initLight(),this.initRenderer(),this.initCamera(),this.initSky(),this.initControl(),this.initRaycaster(),w.isDev&&this.initAxis(),w.isDev&&(this.stats=new Stats),this.clock=new C.Clock,this.render(),window.__HMF__={}}var e,n,r;return e=t,(n=[{key:"initAxis",value:function(){var e=new C.AxesHelper(300);e.position.set(0,0,0),this.scene.add(e)}},{key:"initRouter",value:function(){this.router=new d}},{key:"initScene",value:function(){this.scene=new C.Scene,this.scene.fog=new C.FogExp2(w.fog.color,w.fog.near)}},{key:"initSky",value:function(){var r,a=new p;a.scale.setScalar(45e4),this.scene.add(a),(r=new C.Mesh(new C.SphereBufferGeometry(2e4,16,8),new C.MeshBasicMaterial({color:16777215}))).position.y=-7e5,r.visible=!1,this.scene.add(r);var o={turbidity:10,rayleigh:2,mieCoefficient:.005,mieDirectionalG:.8,luminance:1,inclination:.49,azimuth:.25,sun:!1},i=4e5,s=this;!function(){var e=a.material.uniforms;e.turbidity.value=o.turbidity,e.rayleigh.value=o.rayleigh,e.luminance.value=o.luminance,e.mieCoefficient.value=o.mieCoefficient,e.mieDirectionalG.value=o.mieDirectionalG;var t=Math.PI*(o.inclination-.5),n=2*Math.PI*(o.azimuth-.5);r.position.x=i*Math.cos(n),r.position.y=i*Math.sin(n)*Math.sin(t),r.position.z=i*Math.sin(n)*Math.cos(t),r.visible=o.sun,e.sunPosition.value.copy(r.position),s.renderer.render(s.scene,s.camera.threeCamera)}()}},{key:"initSTL",value:function(){var e=w.obj.stl2.path;this.stl=new ue(this.scene),this.stl.load(e).then(function(e){return console.log("object",e)})}},{key:"initControl",value:function(){var e=new h(C);this.threeControls=new e(this.camera.threeCamera,this.container),this.threeControls.target.set(w.controls.target.x,w.controls.target.y,w.controls.target.z),this.threeControls.autoRotate=w.controls.autoRotate,this.threeControls.autoRotateSpeed=w.controls.autoRotateSpeed,this.threeControls.rotateSpeed=w.controls.rotateSpeed,this.threeControls.zoomSpeed=w.controls.zoomSpeed,this.threeControls.minDistance=w.controls.minDistance,this.threeControls.maxDistance=w.controls.maxDistance,this.threeControls.minPolarAngle=w.controls.minPolarAngle,this.threeControls.maxPolarAngle=w.controls.maxPolarAngle,this.threeControls.enableDamping=w.controls.enableDamping,this.threeControls.enableZoom=w.controls.enableZoom,this.threeControls.dampingFactor=w.controls.dampingFactor}},{key:"initCamera",value:function(){this.camera=new c(this.renderer.threeRenderer)}},{key:"initRenderer",value:function(){this.renderer=new i(this.scene,this.container)}},{key:"initLight",value:function(){var t=this;this.light=new u(this.scene);["ambient","spot"].forEach(function(e){return t.light.place(e)})}},{key:"initRaycaster",value:function(){this.raycaster=new C.Raycaster}},{key:"loadObj",value:function(e){var t=e.path,n=e.scale,r=e.level;return new fe(this).load(t,n,r)}},{key:"loadFbx",value:function(e){var t=e.path;return new se(this).load(t)}},{key:"hideOrShowAllObj",value:function(t,n){this.scene.traverse(function(e){"Group"===e.type&&(e.visible=!!t&&e.userData.level===n)})}},{key:"togglerLoading",value:function(){(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{show:!1}).show?this.container.querySelector("#loading").style.display="block":this.container.querySelector("#loading").style.display="none"}},{key:"showMessage",value:function(){layer.open({content:"1、单击选中物体;<br>\n      2、双击加载物体进入下一级;<br>\n      3、鼠标滚轮点击返回上一级;",title:"交互说明",offset:"rt",id:1,anim:5,shade:0})}},{key:"showObjByLevel",value:function(e){this.hideOrShowAllObj(!1),this.hideOrShowAllObj(!0,e)}},{key:"getFirstIntersectObj",value:function(e){if(e){var t=new C.Vector2;return t.x=e.clientX/window.innerWidth*2-1,t.y=-e.clientY/window.innerHeight*2+1,this.raycaster.setFromCamera(t,this.camera.threeCamera),this.raycaster.intersectObjects(this.scene.children,!0)[0]}}},{key:"canShowInfoPanel",value:function(t){return ge.some(function(e){return t.startsWith(e)})}},{key:"canLoadChild",value:function(t){return ye.some(function(e){return t.startsWith(e)})}},{key:"initGUI",value:function(e){new de(this,e),document.body.appendChild(this.stats.domElement)}},{key:"setCastShadowAndReceiveShadow",value:function(e){e.traverse(function(e){e.isMesh&&(e.castShadow=!0,e.receiveShadow=!0)})}},{key:"getLocalPosition",value:function(e){var t=window.innerWidth/2,n=window.innerHeight/2,r=e.project(this.camera.threeCamera);return[r.x*t+t,-r.y*n+n]}},{key:"modifyEnviroment",value:function(e){var t,n=e.cameraPosition,r=e.ambientLightColor,a=e.reset;void 0!==a&&a?(this.camera.threeCamera.position.set(w.camera.posX,w.camera.posY,w.camera.posZ),this.light.ambientLight.color.set(w.ambientLight.color)):((t=this.camera.threeCamera.position).set.apply(t,ve(n)),this.light.ambientLight.color.set(r))}},{key:"positionAnimate",value:function(e,t,n){new a.a.Tween(e.position).to({x:t[0],y:t[1],z:t[2]},2e3).easing(a.a.Easing.Quadratic.Out).delay(200*n+1500).start()}},{key:"scaleAnimate",value:function(e,t,n){new a.a.Tween(e.scale).to({x:t[0],y:t[1],z:t[2]},2e3).easing(a.a.Easing.Quadratic.Out).delay(200*n).start()}},{key:"render",value:function(){var e=this.clock.getDelta();for(var t in window.__HMF__)if(window.__HMF__.hasOwnProperty(t)){var n=window.__HMF__[t];n.instance&&n.instance.update(e)}a.a.update(),w.isDev&&this.threeControls.update(),w.isDev&&this.stats.update(),this.renderer.render(this.scene,this.camera.threeCamera),requestAnimationFrame(this.render.bind(this))}}])&&me(e.prototype,n),r&&me(e,r),t}(),we=function(){try{var e=document.createElement("canvas");return!(!window.WebGLRenderingContext||!e.getContext("webgl")&&!e.getContext("experimental-webgl"))}catch(e){return!1}}();function Ee(e){return(Ee="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function xe(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Ae(e,t){return!t||"object"!==Ee(t)&&"function"!=typeof t?function(e){if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(e):t}function Te(e){return(Te=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Le(e,t){return(Le=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Pe=function(e){function n(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),(t=Ae(this,Te(n).call(this,e))).initEvent(),t.loadAllObjs(),t.timer=null,t}var t,r,a;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Le(e,t)}(n,be),t=n,(r=[{key:"showObjInfo",value:function(e){var t=this,n=this.getFirstIntersectObj(e);if(n&&(this.canShowInfoPanel(n.object.name)||this.canShowInfoPanel(n.object.parent.name))){if(this.timer)return;this.timer=setTimeout(function(){layer.open({content:"你选中了：".concat(n.object.parent.name||n.object.name),title:"物品信息",offset:"rt",anim:1,shade:0,end:function(){return t.timer=null}})},200)}}},{key:"enterObj",value:function(e){var n=this;clearTimeout(this.timer),this.timer=null;var t=this.getFirstIntersectObj(e),r=t&&t.object.parent.userData.childName;if(t&&this.canLoadChild(r))if(this.hideOrShowAllObj(!1),window.__HMF__[r]){window.__HMF__[r].visible=!0;var a=this.router.getLastChild();a&&this.router.push({current:w.obj[r].level,parent:a.current})}else this.togglerLoading({show:!0}),this.loadObj(w.obj[r]).then(function(e){n.togglerLoading(),e.userData.childName=w.obj[r].childName,e.userData.level=w.obj[r].level,n.modifyEnviroment({cameraPosition:[150,150,500],ambientLightColor:15132390});var t=n.router.getLastChild();t&&n.router.push({current:w.obj[r].level,parent:t.current})})}},{key:"initEvent",value:function(){var n=this;window.addEventListener("dblclick",this.enterObj.bind(this),!1),window.addEventListener("click",this.showObjInfo.bind(this),!1),window.addEventListener("mouseup",function(e){if(2===e.which){var t=n.router.pop();t&&n.showObjByLevel(t.parent),"one"===t.parent&&n.modifyEnviroment({reset:!0})}},!1)}},{key:"loadAllObjs",value:function(){var b=this;this.loadObj(w.obj.group_build_out_1).then(function(e){e.position.set(-138,-400,148.5);b.positionAnimate(e,[-138,0,148.5],0),e.name="building_1",e.userData.childName=w.obj.group_build_out_1.childName;for(var t=1;t<4;t++){var n=e.clone();n.name="building_".concat(t+1),n.position.set(40*t-138,-400,148.5);var r=[40*t-138,0,148.5];b.positionAnimate(n,r,t),b.scene.add(n)}for(var a=4;a<9;a++){var o=e.clone();o.name="building_".concat(a+1),o.position.set(40*(a-3)-218,0,108.5),o.position.set(40*(a-3)-218,-400,108.5);var i=[40*(a-3)-218,0,108.5];b.positionAnimate(o,i,a),b.scene.add(o)}for(var s=9;s<14;s++){var c=e.clone();c.name="building_".concat(s+1),c.position.set(42*(s-9),-400,0);var l=[42*(s-9),0,0];b.positionAnimate(c,l,s),b.scene.add(c)}for(var u=14;u<18;u++){var h=e.clone();h.name="building_".concat(u+1),h.position.set(42*(u-14),-400,-55);var p=[42*(u-14),0,-55];b.positionAnimate(h,p,u),b.scene.add(h)}for(var f=18;f<21;f++){var d=e.clone();d.name="building_".concat(f+1),d.position.set(42*(f-18)+42,-400,-110);var v=[42*(f-18)+42,0,-110];b.positionAnimate(d,v,f),b.scene.add(d)}for(var m=21;m<27;m++){var g=e.clone();g.name="building_".concat(m+1),g.position.set(31*(m-21)-30,-400,-156);var y=[31*(m-21)-30,0,-156];b.positionAnimate(g,y,m),b.scene.add(g)}}),this.loadObj(w.obj.group_road_1).then(function(e){b.showMessage(),b.togglerLoading(),w.isDev&&b.initGUI(e),b.setCastShadowAndReceiveShadow(e)}),this.loadObj(w.obj.group_villa_1).then(function(e){e.name="villa_1",e.position.set(87,1400,105);b.positionAnimate(e,[87,0,105],0);for(var t=1;t<3;t++){var n=e.clone();n.name="villa_".concat(t+1),e.position.set(85+30*t,1400,105);var r=[85+30*t,0,105];b.positionAnimate(n,r,t),b.scene.add(n)}for(var a=3;a<5;a++){var o=e.clone();o.name="villa_".concat(a+1),o.rotation.set(0,-Math.PI/2,0),e.position.set(104.5+35.5*(a-3),1400,70);var i=[104.5+35.5*(a-3),0,70];b.positionAnimate(o,i,a),b.scene.add(o)}}),this.loadObj(w.obj.group_shop_1).then(function(e){e.scale.set(100,100,100);var t=[w.obj.globalScale,w.obj.globalScale,w.obj.globalScale];b.scaleAnimate(e,t,1)}),this.loadObj(w.obj.group_parking_1).then(function(e){e.position.set(181.5,0,-161)}),this.loadFbx(w.obj.group_barrier_gate_fbx).then(function(e){e.name="",e.children[1].name="barrier_gate_out_1",e.children[4].name="barrier_gate_in_1",e.position.set(24,5,188)}),this.loadObj(w.obj.group_barrier_gate_obj).then(function(e){e.children[3].name="barrier_gate_out_2",e.children[4].name="barrier_gate_in_2",e.position.set(216,0,-40),e.rotation.set(0,Math.PI/2,0);var t=e.clone();t.children[3].name="barrier_gate_out_3",t.children[4].name="barrier_gate_in_3",t.position.set(-60,0,-120),t.rotation.set(0,-Math.PI/2,0),b.scene.add(t);var n=e.clone();n.children[3].name="barrier_gate_out_5",n.children[4].name="barrier_gate_in_5",n.position.set(-208,0,66),n.scale.set(.22,.22,.22),n.rotation.set(0,-Math.PI/2,0),b.scene.add(n)}),this.loadObj(w.obj.group_charging_pile_1).then(function(e){e.position.set(192,0,-80);for(var t=1;t<19;t++){var n=e.clone();n.name="charging_pile_".concat(t+1),n.position.set(192,0,-80-3*t),b.scene.add(n)}}),this.loadObj(w.obj.water_obj).then(function(e){e.position.set(-160,0,10)})}}])&&xe(t.prototype,r),a&&xe(t,a),n}();we?(window.devicePixelRatio&&(w.dpr=window.devicePixelRatio),new Pe(document.getElementById("appContainer"))):alert("您的浏览器不支持 WebGL,请使用最新版本的 Chrome 浏览器")}},[[4,1,2]]]);